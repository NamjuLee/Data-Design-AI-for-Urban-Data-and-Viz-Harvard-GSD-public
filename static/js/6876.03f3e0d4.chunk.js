"use strict";(self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD=self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD||[]).push([[6876],{43244:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(37762),a=r(15671),i=r(43144),s=r(92026),u=function(){function e(t){(0,a.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,i.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,r=(0,n.Z)(this._buffer);try{for(r.s();!(t=r.n()).done;){var a=t.value;if((0,s.pC)(a)&&e(a))return a}}catch(i){r.e(i)}finally{r.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();(0,s.pC)(t);)e&&e(t),t=this.dequeue()}}]),e}()},36876:function(e,t,r){r.d(t,{k:function(){return g},p:function(){return I}});var n=r(37762),a=r(15671),i=r(43144),s=r(60136),u=r(29388),d=r(43244),o=r(91505),c=(r(93169),r(92026)),h=r(31581),l=r(41414),f=r(24170),_=r(5448);function y(e,t){return e<<16|t}function v(e){return(4294901760&e)>>>16}function p(e){return 65535&e}var g={getObjectId:function(e){return e.getObjectId()},getAttributes:function(e){return e.readAttributes()},getAttribute:function(e,t){return e.readAttribute(t)},cloneWithGeometry:function(e,t){return e},getGeometry:function(e){return e.readHydratedGeometry()},getCentroid:function(e,t){return e.readCentroid()}},I=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i){var s;return(0,a.Z)(this,r),(s=t.call(this,e,n)).featureAdapter=g,s.events=new o.Z,s._featureSetsByInstance=new Map,s._objectIdToDisplayId=new Map,s._spatialIndexInvalid=!0,s._indexSearchCache=new d.Z(50),s._index=(0,h.r)(9,(function(e){return{minX:s._storage.getXMin(e),minY:s._storage.getYMin(e),maxX:s._storage.getXMax(e),maxY:s._storage.getYMax(e)}})),s.mode=i,s}return(0,i.Z)(r,[{key:"storeStatistics",get:function(){var e=0,t=0,r=0;return this.forEach((function(n){var a=n.readGeometry();a&&(t+=a.isPoint?1:a.lengths.reduce((function(e,t){return e+t}),0),r+=a.isPoint?1:a.lengths.length,e+=1)})),{featureCount:e,vertexCount:t,ringCount:r}}},{key:"hasInstance",value:function(e){return this._featureSetsByInstance.has(e)}},{key:"onTileData",value:function(e,t){if((0,c.Wi)(t.addOrUpdate))return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){for(var r=t.addOrUpdate.getCursor();r.next();){var n=r.getDisplayId();this.setComputedAttributes(this._storage,r,n,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);for(var a=t.addOrUpdate.getCursor();a.next();)this._insertFeature(a,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}},{key:"search",value:function(e){var t=this;this._rebuildIndex();var r=e.id,a=this._indexSearchCache.find((function(e){return e.tileId===r}));if((0,c.pC)(a))return a.readers;var i,s=new Map,u=this._searchIndex(e.bounds),d=[],o=(0,n.Z)(u);try{for(o.s();!(i=o.n()).done;){var h=i.value,l=this._storage.getInstanceId(h),f=v(l),y=p(l);s.has(f)||s.set(f,[]),s.get(f).push(y)}}catch(g){o.e(g)}finally{o.f()}return s.forEach((function(e,r){var n=t._featureSetsByInstance.get(r);d.push(_.t.from(n,e))})),this._indexSearchCache.enqueue({tileId:r,readers:d}),d}},{key:"insert",value:function(e){for(var t=e.getCursor(),r=this._storage;t.next();){var n,a=y(t.instance,t.getIndex()),i=t.getObjectId(),s=null!==(n=this._objectIdToDisplayId.get(i))&&void 0!==n?n:this._storage.createDisplayId();t.setDisplayId(s),r.setInstanceId(s,a),this._objectIdToDisplayId.set(i,s)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}},{key:"remove",value:function(e){var t=this._objectIdToDisplayId.get(e);if(t){var r=this._storage.getInstanceId(t),n=p(r),a=v(r),i=this._featureSetsByInstance.get(a);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),i.removeAtIndex(n),i.isEmpty&&this._featureSetsByInstance.delete(a),this._spatialIndexInvalid=!0}}},{key:"toArray",value:function(){var e=new Array;return this.forEach((function(t){return e.push(t)})),e}},{key:"forEach",value:function(e){var t=this;this._objectIdToDisplayId.forEach((function(r){var n=t._storage.getInstanceId(r),a=t._lookupFeature(n);e(a)}))}},{key:"forEachUnsafe",value:function(e){var t=this;this._objectIdToDisplayId.forEach((function(r){var n=t._storage.getInstanceId(r),a=v(n),i=p(n),s=t._getFeatureSet(a);s.setIndex(i),e(s)}))}},{key:"forEachInBounds",value:function(e,t){var r,a=this._searchIndex(e),i=(0,n.Z)(a);try{for(i.s();!(r=i.n()).done;){var s=r.value,u=this.lookupFeatureByDisplayId(s,this._storage);t((0,c.Wg)(u))}}catch(d){i.e(d)}finally{i.f()}}},{key:"forEachBounds",value:function(e,t,r){this._rebuildIndex();var a,i=[0,0,0,0],s=(0,n.Z)(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(u.readGeometry()){var d=u.getDisplayId();i[0]=this._storage.getXMin(d),i[1]=this._storage.getYMin(d),i[2]=this._storage.getXMax(d),i[3]=this._storage.getYMax(d),t((0,l.JR)(r,i))}}}catch(o){s.e(o)}finally{s.f()}}},{key:"sweepFeatures",value:function(e,t,r){var n=this;this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach((function(a,i){e.has(a)||(t.releaseDisplayId(a),r&&r.unsetAttributeData(a),n._objectIdToDisplayId.delete(i))})),this.events.emit("changed")}},{key:"sweepFeatureSets",value:function(e){var t=this;this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach((function(r,n){e.has(n)||t._featureSetsByInstance.delete(n)}))}},{key:"lookupObjectId",value:function(e,t){var r=this.lookupFeatureByDisplayId(e,t);return(0,c.Wi)(r)?null:r.getObjectId()}},{key:"lookupDisplayId",value:function(e){return this._objectIdToDisplayId.get(e)}},{key:"lookupFeatureByDisplayId",value:function(e,t){var r=t.getInstanceId(e);return this._lookupFeature(r)}},{key:"lookupByDisplayIdUnsafe",value:function(e){var t=this._storage.getInstanceId(e),r=v(t),n=p(t),a=this._getFeatureSet(r);return a?(a.setIndex(n),a):null}},{key:"_insertFeature",value:function(e,t){var r=this._storage,n=e.getObjectId(),a=y(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());var i=this._objectIdToDisplayId.get(n);i||(i=r.createDisplayId(),this._objectIdToDisplayId.set(n,i),this._spatialIndexInvalid=!0),e.setDisplayId(i),r.setInstanceId(i,a),this.setComputedAttributes(r,e,i,t)}},{key:"_searchIndex",value:function(e){this._rebuildIndex();var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}},{key:"_rebuildIndex",value:function(){var e=this;if(this._spatialIndexInvalid){var t=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((function(r){for(var n=r.getCursor();n.next();){var a=n.getDisplayId();e._storage.setBounds(a,n)&&t.push(a)}})):this._objectIdToDisplayId.forEach((function(r){var n=e._storage.getInstanceId(r);e._storage.setBounds(r,e._lookupFeature(n))&&t.push(r)})),this._index.clear(),this._index.load(t),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}}},{key:"_lookupFeature",value:function(e){var t=v(e),r=this._getFeatureSet(t);if(!r)return null;var n=r.getCursor(),a=p(e);return n.setIndex(a),n}},{key:"_getFeatureSet",value:function(e){return this._featureSetsByInstance.get(e)}}]),r}(f.J)},24170:function(e,t,r){r.d(t,{J:function(){return y}});var n=r(1413),a=r(37762),i=r(74165),s=r(15861),u=r(15671),d=r(43144),o=r(93169),c=r(92026),h=r(48732),l=r(819),f=r(32718);var _=r.e(6553).then(r.bind(r,16553)),y=function(){function e(t,r){(0,u.Z)(this,e),this._canCacheExpressionValue=!1,this._sourceInfo=t,this._storage=r,this._bitsets={computed:r.getBitset(r.createBitset())}}return(0,d.Z)(e,[{key:"storage",get:function(){return this._storage}},{key:"invalidate",value:function(){this._bitsets.computed.clear()}},{key:"updateSchema",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,d,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,h.Hg)(this._schema,r),this._schema=r,r&&!(0,c.Wi)(n)&&(0,h.uD)(n,"attributes")){e.next=3;break}return e.abrupt("return");case 3:(0,o.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",n),this._bitsets.computed.clear(),t.targets[r.name]=!0,a=r.attributes,s=[],u=[],e.t0=(0,i.Z)().keys(a);case 6:if((e.t1=e.t0()).done){e.next=20;break}d=e.t1.value,l=a[d],e.t2=l.type,e.next="field"===e.t2?12:"expression"===e.t2?13:"label-expression"===e.t2?15:"statistic"===e.t2?17:18;break;case 12:return e.abrupt("break",18);case 13:return s.push(this._createArcadeComputedField(l)),e.abrupt("break",18);case 15:return s.push(this._createLabelArcadeComputedField(l)),e.abrupt("break",18);case 17:u.push(l);case 18:e.next=6;break;case 20:return e.next=22,Promise.all(s);case 22:this._computedFields=e.sent,this._canCacheExpressionValue=!this._computedFields.some((function(e){return"expression"===e.type&&(0,c.pC)(e.expression)&&e.expression.referencesScale()})),this._statisticFields=u;case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setComputedAttributes",value:function(e,t,r,n){var i=this._bitsets.computed;if(!this._canCacheExpressionValue||!i.has(r)){i.set(r);var s,u=(0,a.Z)(this._computedFields);try{for(u.s();!(s=u.n()).done;){var d=s.value,o=this._evaluateField(t,d,n);switch(d.resultType){case"numeric":e.setComputedNumericAtIndex(r,d.fieldIndex,o);break;case"string":e.setComputedStringAtIndex(r,d.fieldIndex,o)}}}catch(c){u.e(c)}finally{u.f()}}}},{key:"_createArcadeComputedField",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._sourceInfo.spatialReference,a=this._sourceInfo.fieldsIndex,e.t0=n.Z,e.t1=(0,n.Z)({},t),e.t2={},e.next=6,(0,l.Yi)(t.valueExpression,r,a);case 6:return e.t3=e.sent,e.t4={expression:e.t3},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createLabelArcadeComputedField",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var r,a,s,u,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._sourceInfo.spatialReference,a=this._sourceInfo.fieldsIndex,e.next=4,_;case 4:return s=e.sent,u=s.createLabelFunction,e.next=8,u(t.label,a,r);case 8:return d=e.sent,e.abrupt("return",(0,n.Z)((0,n.Z)({},t),{},{builder:d}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_evaluateField",value:function(e,t,r){switch(t.type){case"label-expression":var a=e.readArcadeFeature();return t.builder.evaluate(a)||"";case"expression":return function(e,t,r){if((0,c.Wi)(e))return null;var a=t.readArcadeFeature();try{return e.evaluate((0,n.Z)((0,n.Z)({},r),{},{$feature:a}))}catch(i){return f.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",i),null}}(t.expression,e,{$view:{scale:r}})}}}]),e}()},5448:function(e,t,r){r.d(t,{t:function(){return d}});var n=r(15671),a=r(43144),i=r(60136),s=r(29388),u=r(92010),d=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e,a){var i;return(0,n.Z)(this,r),(i=t.call(this,u.s.createInstance(),e.fullSchema()))._currentIndex=-1,i._reader=e,i._indices=a,i}return(0,a.Z)(r,[{key:"hasNext",get:function(){return this._currentIndex+1<this._indices.length}},{key:"getSize",value:function(){return this._indices.length}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}},{key:"next",value:function(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}},{key:"_nextIndex",value:function(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}},{key:"setArcadeSpatialReference",value:function(e){this._reader.setArcadeSpatialReference(e)}},{key:"attachStorage",value:function(e){this._reader.attachStorage(e)}},{key:"geometryType",get:function(){return this._reader.geometryType}},{key:"hasFeatures",get:function(){return this._reader.hasFeatures}},{key:"exceededTransferLimit",get:function(){return this._reader.exceededTransferLimit}},{key:"hasZ",get:function(){return this._reader.hasZ}},{key:"hasM",get:function(){return this._reader.hasM}},{key:"getStorage",value:function(){return this._reader.getStorage()}},{key:"getComputedNumeric",value:function(e){return this._reader.getComputedNumericAtIndex(0)}},{key:"setComputedNumeric",value:function(e,t){return this._reader.setComputedNumericAtIndex(t,0)}},{key:"getComputedString",value:function(e){return this._reader.getComputedStringAtIndex(0)}},{key:"setComputedString",value:function(e,t){return this._reader.setComputedStringAtIndex(0,t)}},{key:"getComputedNumericAtIndex",value:function(e){return this._reader.getComputedNumericAtIndex(e)}},{key:"setComputedNumericAtIndex",value:function(e,t){this._reader.setComputedNumericAtIndex(e,t)}},{key:"getComputedStringAtIndex",value:function(e){return this._reader.getComputedStringAtIndex(e)}},{key:"setComputedStringAtIndex",value:function(e,t){return this._reader.setComputedStringAtIndex(e,t)}},{key:"transform",value:function(e,t,r,n){var a=this.copy();return a._reader=this._reader.transform(e,t,r,n),a}},{key:"readAttribute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._reader.readAttribute(e,t)}},{key:"readAttributes",value:function(){return this._reader.readAttributes()}},{key:"joinAttributes",value:function(e){return this._reader.joinAttributes(e)}},{key:"readArcadeFeature",value:function(){return this._reader.readArcadeFeature()}},{key:"geometry",value:function(){return this._reader.geometry()}},{key:"field",value:function(e){return this.readAttribute(e,!0)}},{key:"hasField",value:function(e){return this._reader.hasField(e)}},{key:"setField",value:function(e,t){return this._reader.setField(e,t)}},{key:"keys",value:function(){return this._reader.keys()}},{key:"castToText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._reader.castToText(e)}},{key:"getQuantizationTransform",value:function(){return this._reader.getQuantizationTransform()}},{key:"getFieldNames",value:function(){return this._reader.getFieldNames()}},{key:"getAttributeHash",value:function(){return this._reader.getAttributeHash()}},{key:"getObjectId",value:function(){return this._reader.getObjectId()}},{key:"getDisplayId",value:function(){return this._reader.getDisplayId()}},{key:"setDisplayId",value:function(e){return this._reader.setDisplayId(e)}},{key:"getGroupId",value:function(){return this._reader.getGroupId()}},{key:"setGroupId",value:function(e){return this._reader.setGroupId(e)}},{key:"getXHydrated",value:function(){return this._reader.getXHydrated()}},{key:"getYHydrated",value:function(){return this._reader.getYHydrated()}},{key:"getX",value:function(){return this._reader.getX()}},{key:"getY",value:function(){return this._reader.getY()}},{key:"setIndex",value:function(e){return this._reader.setIndex(e)}},{key:"getIndex",value:function(){return this._reader.getIndex()}},{key:"readLegacyFeature",value:function(){return this._reader.readLegacyFeature()}},{key:"readOptimizedFeature",value:function(){return this._reader.readOptimizedFeature()}},{key:"readLegacyPointGeometry",value:function(){return this._reader.readLegacyPointGeometry()}},{key:"readLegacyGeometry",value:function(){return this._reader.readLegacyGeometry()}},{key:"readLegacyCentroid",value:function(){return this._reader.readLegacyCentroid()}},{key:"readGeometryArea",value:function(){return this._reader.readGeometryArea()}},{key:"readUnquantizedGeometry",value:function(){return this._reader.readUnquantizedGeometry()}},{key:"readHydratedGeometry",value:function(){return this._reader.readHydratedGeometry()}},{key:"readGeometry",value:function(){return this._reader.readGeometry()}},{key:"readCentroid",value:function(){return this._reader.readCentroid()}},{key:"_readAttribute",value:function(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}},{key:"_readAttributes",value:function(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}}],[{key:"from",value:function(e,t){return new r(e.copy(),t)}}]),r}(u.s)}}]);
//# sourceMappingURL=6876.03f3e0d4.chunk.js.map