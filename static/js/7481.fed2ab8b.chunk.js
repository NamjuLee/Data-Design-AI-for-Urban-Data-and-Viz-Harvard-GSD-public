"use strict";(self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD=self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD||[]).push([[7481],{77095:function(e,t,r){r.d(t,{hN:function(){return G},P0:function(){return T},cW:function(){return k}});var n=r(74165),i=r(37762),s=r(15861),a=r(10064),u=r(34066),o=r(66504);var l=r(77981),c=r(92975);function f(e,t){return e?t?4:3:t?3:2}function p(e,t,r,n,i,s){var a=f(i,s),u=n.coords,o=n.lengths;if(!o)return!1;for(var l=0,c=0;l<o.length;l++,c+=a)if(!h(e,t,r,u[c],u[c+1]))return!1;return!0}function h(e,t,r,n,s){if(!e)return!1;var a,u=f(t,r),o=e.coords,l=e.lengths,c=!1,p=0,h=(0,i.Z)(l);try{for(h.s();!(a=h.n()).done;){var v=a.value;c=d(c,o,u,p,v,n,s),p+=v*u}}catch(y){h.e(y)}finally{h.f()}return c}function d(e,t,r,n,i,s,a){for(var u=e,o=n,l=n,c=n+i*r;l<c;l+=r){(o=l+r)===c&&(o=n);var f=t[l],p=t[l+1],h=t[o],d=t[o+1];(p<a&&d>=a||d<a&&p>=a)&&f+(a-p)/(d-p)*(h-f)<s&&(u=!u)}return u}var v=r(83406),y=r(80457),m=r(19995),_=r(31904),b="feature-store:unsupported-query",w={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},x={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function R(e){return null!=e&&!0===g[e]}function I(e){return null!=e&&!0===S[(0,l.Ji)(e)]}function Z(e){return null!=e&&!0===x[e]}function k(e,t,n,i,s){if((0,l.oU)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var a=(0,v.Uy)(new y.Z,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return h(e,t,r,n.coords[0],n.coords[1])}(a,!1,!1,e)}))}if((0,l.oU)(t)&&"esriGeometryMultipoint"===n){var c=(0,v.Uy)(new y.Z,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return p(c,!1,!1,e,i,s)}))}if((0,l.YX)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return(0,u.aV)(t,(0,_.Op)(n,i,s,e))}));if((0,l.YX)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return(0,u.lQ)(t,(0,_.Op)(n,i,s,e))}));if((0,l.YX)(t)&&"esriSpatialRelIntersects"===e){var f=function(e){return"mesh"===e?o.h_:(0,o.IY)(e)}(n);return Promise.resolve((function(e){return f(t,(0,_.Op)(n,i,s,e))}))}return Promise.all([r.e(9058),r.e(3645)]).then(r.bind(r,50309)).then((function(r){var a=r[w[e]].bind(null,t.spatialReference,t);return function(e){return a((0,_.Op)(n,i,s,e))}}))}function T(e,t,r){return F.apply(this,arguments)}function F(){return F=(0,s.Z)((0,n.Z)().mark((function e(t,r,i){var s,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.spatialRel,!(u=t.geometry)){e.next=11;break}if(R(s)){e.next=4;break}throw new a.Z(b,"Unsupported query spatial relationship",{query:t});case 4:if(!(0,c.JY)(u.spatialReference)||!(0,c.JY)(i)){e.next=11;break}if(I(u)){e.next=7;break}throw new a.Z(b,"Unsupported query geometry type",{query:t});case 7:if(Z(r)){e.next=9;break}throw new a.Z(b,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",(0,m._W)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}function G(e){if((0,l.YX)(e))return!0;if((0,l.oU)(e)){var t,r=(0,i.Z)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(s){r.e(s)}finally{r.f()}return!0}return!1}},20311:function(e,t,r){function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==u||isNaN(u)||(a=Math.max(a,u))}));else{var u=n||i;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(s=Math.min(s,t),a=Math.max(a,t))}))}return{start:s,end:a}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var s=t.start,a=t.end;return null===s&&null===a?null:void 0===s&&void 0===a?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(s){var a=e.getAttribute(s,t),u=e.getAttribute(s,r);return(null==a||a<=i)&&(null==u||u>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,s,a):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var s=e.getAttribute(i,t);return s>=r&&s<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,s,a)}r.d(t,{R:function(){return n},y:function(){return i}})},31904:function(e,t,r){r.d(t,{EG:function(){return S},Op:function(){return x},S2:function(){return P},Up:function(){return R},j6:function(){return Z},vF:function(){return m}});var n=r(74165),i=r(15861),s=r(43404),a=r(92026),u=r(68860),o=r(52587),l=r(94446),c=r(77981),f=r(91340),p=r(92975),h=r(83406),d=r(80457),v=r(19995),y=new s.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),m=Object.freeze({}),_=new d.Z,b=new d.Z,w=new d.Z,g={esriGeometryPoint:h.fQ,esriGeometryPolyline:h.J6,esriGeometryPolygon:h.eG,esriGeometryMultipoint:h.Iv};function S(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM;if((0,a.Wi)(t))return null;var s=e.hasZ&&n,u=e.hasM&&i;if(r){var o=(0,h.Nh)(w,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return(0,h.fQ)(o,s,u)}return(0,h.fQ)(t,s,u)}function x(e,t,r,n,i,s){var u,o,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,f=t&&l,p=r&&c,d=(0,a.pC)(n)?"coords"in n?n:n.geometry:null;if((0,a.Wi)(d))return null;if(i){var v,y,m=(0,h.zj)(b,d,t,r,e,i,l,c);return s&&(m=(0,h.Nh)(w,m,f,p,e,s)),null!==(v=null===(y=g[e])||void 0===y?void 0:y.call(g,m,f,p))&&void 0!==v?v:null}if(s){var S,x,R=(0,h.Nh)(w,d,t,r,e,s,l,c);return null!==(S=null===(x=g[e])||void 0===x?void 0:x.call(g,R,f,p))&&void 0!==S?S:null}return(0,h.hY)(_,d,t,r,l,c),null!==(u=null===(o=g[e])||void 0===o?void 0:o.call(g,_,f,p))&&void 0!==u?u:null}function R(e,t,r){return I.apply(this,arguments)}function I(){return(I=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var s,a,u,o,l,c,f,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.outFields,a=t.orderByFields,u=t.groupByFieldsForStatistics,o=t.outStatistics,s)for(l=0;l<s.length;l++)s[l]=s[l].trim();if(a)for(c=0;c<a.length;c++)a[c]=a[c].trim();if(u)for(f=0;f<u.length;f++)u[f]=u[f].trim();if(o)for(p=0;p<o.length;p++)o[p].onStatisticField&&(o[p].onStatisticField=o[p].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),Z(t,r,i)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t,r){return k.apply(this,arguments)}function k(){return(k=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var s,u,o,p,h,d,y,_,b;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(s=t.where,t.where=s=s&&s.trim(),(!s||/^1 *= *1$/.test(s)||r&&r===s)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,G(t);case 7:if(u=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(o=t.geometry.spatialReference,(u=(0,l.aO)(u)).spatialReference=o),!u){e.next=27;break}return e.next=12,(0,v._W)(u.spatialReference,i);case 12:return u=F(u,i),e.next=15,(0,f.aX)((0,c.im)(u));case 15:if(h=e.sent[0],!(0,a.Wi)(h)){e.next=18;break}throw m;case 18:return d="quantizationParameters"in t&&(null===(p=t.quantizationParameters)||void 0===p?void 0:p.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,y=d&&T(u,i)?{densificationStep:8*d}:void 0,_=h.toJSON(),e.next=23,(0,v.iV)(_,_.spatialReference,i,y);case 23:if(b=e.sent){e.next=26;break}throw m;case 26:b.spatialReference=i,t.geometry=b;case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){if(!e)return!1;var r=e.spatialReference;return((0,c.YX)(e)||(0,c.oU)(e)||(0,c.l9)(e))&&!(0,p.fS)(r,t)&&!(0,o.Up)(r,t)}function F(e,t){var r=e.spatialReference;return T(e,t)&&(0,c.YX)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function G(e){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,s,a,o,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.distance,i=t.units,s=t.geometry,null!=r&&!("vertexAttributes"in s)){e.next=3;break}return e.abrupt("return",s);case 3:if(a=s.spatialReference,o=i?y.fromJSON(i):(0,u.qE)(a),!a||!(0,p.sT)(a)&&!(0,p.sS)(a)){e.next=9;break}e.t0=s,e.next=12;break;case 9:return e.next=11,(0,v._W)(a,p.Zn).then((function(){return(0,v.iV)(s,p.Zn)}));case 11:e.t0=e.sent;case 12:return l=e.t0,e.next=15,E();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(l.spatialReference,l,r,o));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return N.apply(this,arguments)}function N(){return(N=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(9058),r.e(3645)]).then(r.bind(r,50309));case 2:return e.abrupt("return",e.sent.geodesicBuffer);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return e&&A in e?JSON.parse(JSON.stringify(e,U)):e}var A="_geVersion",U=function(e,t){return e!==A?t:void 0}},37481:function(e,t,r){r.r(t),r.d(t,{default:function(){return S}});var n=r(74165),i=r(15861),s=r(37762),a=r(15671),u=r(43144),o=r(10064),l=r(32718),c=r(92026),f=r(65156),p=r(376),h=r(77095),d=r(20311),v=r(31904),y=r(86638),m=r(36876),_=l.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),b={getAttribute:function(e,t){return e.field(t)}};function w(e,t){return g.apply(this,arguments)}function g(){return g=(0,i.Z)((0,n.Z)().mark((function e(t,i){var s,a,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(8562).then(r.bind(r,48562));case 2:return s=e.sent,e.prev=3,(a=s.WhereClause.create(t,i)).isStandardized||(u=new o.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a),_.error(u)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return a.testFeature(t,b)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(_.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])}))),g.apply(this,arguments)}var S=function(){function e(t){(0,a.Z)(this,e),this._geometryBounds=(0,f.Ue)(),this._idToVisibility=new Map,this._serviceInfo=t}return(0,u.Z)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,r){e._idToVisibility.set(r,0)}))}},{key:"setKnownIds",value:function(e){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._idToVisibility.set(n,1)}}catch(i){r.e(i)}finally{r.f()}}},{key:"setTrue",value:function(e){var t=this,r=[],n=[],i=new Set(e);return this._idToVisibility.forEach((function(e,s){var a=!!(1&t._idToVisibility.get(s)),u=i.has(s);!a&&u?r.push(s):a&&!u&&n.push(s),t._idToVisibility.set(s,u?3:0)})),{show:r,hide:n}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,r=this.where,n=this.timeExtent,i=this.objectIds;return y.Z.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:n,objectIds:i})}},{key:"update",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,(0,v.j6)(t,null,r);case 3:return i=e.sent,e.next=6,Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,w(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return r=t.geometry,i=t.spatialRel||"esriSpatialRelIntersects",e.next=6,(0,h.cW)(i,r,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:s=e.sent,(0,p.$P)(this._geometryBounds,r),this._spatialQueryOperator=s,this.geometry=r,this.spatialRel=i;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,d.y)(this._serviceInfo.timeInfo,e.timeExtent,m.k);else{var t=new o.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);l.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!!(0,c.Wi)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(r,n){1&r||(e._idToVisibility.set(n,1),t.push(n))})),t}}]),e}()}}]);
//# sourceMappingURL=7481.fed2ab8b.chunk.js.map