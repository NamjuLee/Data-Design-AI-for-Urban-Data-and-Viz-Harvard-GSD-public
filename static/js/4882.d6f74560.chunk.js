"use strict";(self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD=self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD||[]).push([[4882],{11873:function(e,t,n){function i(){return[1,0,0,0,1,0,0,0,1]}function r(e,t){return new Float64Array(e,t,9)}n.d(t,{a:function(){return r},c:function(){return i}});Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,n,i,r,a,s,u,o){return[e,t,n,i,r,a,s,u,o]},createView:r},Symbol.toStringTag,{value:"Module"}))},8975:function(e,t,n){function i(){return new Float32Array(3)}function r(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,n){var i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=n,i}function s(){return i()}function u(){return a(1,1,1)}function o(){return a(1,0,0)}function l(){return a(0,1,0)}function h(){return a(0,0,1)}n.d(t,{b:function(){return r},c:function(){return i},f:function(){return a}});var c=s(),f=u(),v=o(),d=l(),p=h();Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:r,fromValues:a,createView:function(e,t){return new Float32Array(e,t,3)},zeros:s,ones:u,unitX:o,unitY:l,unitZ:h,ZEROS:c,ONES:f,UNIT_X:v,UNIT_Y:d,UNIT_Z:p},Symbol.toStringTag,{value:"Module"}))},47991:function(e,t,n){n.d(t,{SR:function(){return p},Ui:function(){return d}});var i=n(43144),r=n(15671),a=n(37762),s=n(29439),u=n(92026),o=n(65156),l=n(376),h=n(69662),c=n(77981),f=n(76335),v=n(92975);function d(e){return y(e,!0)}function p(e){return y(e,!1)}function y(e,t){if((0,u.Wi)(e))return null;var n=e.spatialReference,i=(0,v.C5)(n),r="toJSON"in e?e.toJSON():e;if(!i)return r;var a=(0,v.sS)(n)?102100:4326,s=f.UZ[a].maxX,o=f.UZ[a].minX;if((0,c.wp)(r))return m(r,s,o);if((0,c.aW)(r))return r.points=r.points.map((function(e){return m(e,s,o)})),r;if((0,c.YX)(r))return _(r,i);if((0,c.oU)(r)||(0,c.l9)(r)){var h=(0,l.$P)(k,r),d={xmin:h[0],ymin:h[1],xmax:h[2],ymax:h[3]},p=(0,f.XZ)(d.xmin,o)*(2*s),y=0===p?r:(0,f.Sy)(r,p);return d.xmin+=p,d.xmax+=p,d.xmax>s?Z(y,s,t):d.xmin<o?Z(y,o,t):y}return r}function _(e,t){if(!t)return e;var n=function(e,t){var n=[],i=e.ymin,r=e.ymax,a=e.xmin,u=e.xmax,o=e.xmax-e.xmin,l=(0,s.Z)(t.valid,2),h=l[0],c=l[1],f=x(e.xmin,t),v=f.x,d=f.frameId,p=x(e.xmax,t),y=p.x,_=p.frameId,m=v===y&&o>0;if(o>2*c){var w={xmin:a<u?v:y,ymin:i,xmax:c,ymax:r},Z={xmin:h,ymin:i,xmax:a<u?y:v,ymax:r},k={xmin:0,ymin:i,xmax:c,ymax:r},b={xmin:h,ymin:i,xmax:0,ymax:r},S=[],T=[];g(w,k)&&S.push(d),g(w,b)&&T.push(d),g(Z,k)&&S.push(_),g(Z,b)&&T.push(_);for(var I=d+1;I<_;I++)S.push(I),T.push(I);n.push(new C(w,[d]),new C(Z,[_]),new C(k,S),new C(b,T))}else v>y||m?n.push(new C({xmin:v,ymin:i,xmax:c,ymax:r},[d]),new C({xmin:h,ymin:i,xmax:y,ymax:r},[_])):n.push(new C({xmin:v,ymin:i,xmax:y,ymax:r},[d]));return n}(e,t).map((function(e){return e.extent}));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function m(e,t,n){if(Array.isArray(e)){var i=e[0];if(i>t){var r=(0,f.XZ)(i,t);e[0]=i+r*(-2*t)}else if(i<n){var a=(0,f.XZ)(i,n);e[0]=i+a*(-2*n)}}else{var s=e.x;if(s>t){var u=(0,f.XZ)(s,t);e.x+=u*(-2*t)}else if(s<n){var o=(0,f.XZ)(s,n);e.x+=o*(-2*n)}}return e}function x(e,t){var n,i=(0,s.Z)(t.valid,2),r=i[0],a=i[1],u=2*a,o=0;return e>a?(e-=(n=Math.ceil(Math.abs(e-a)/u))*u,o=n):e<r&&(e+=(n=Math.ceil(Math.abs(e-r)/u))*u,o=-n),{x:e,frameId:o}}function g(e,t){var n=t.xmin,i=t.ymin,r=t.xmax,a=t.ymax;return w(e,n,i)&&w(e,n,a)&&w(e,r,a)&&w(e,r,i)}function w(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}function Z(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(0,c.l9)(e);if(i&&(0,h.Zy)(e),n)return(new b).cut(e,t);for(var r=i?e.rings:e.paths,s=i?4:2,u=r.length,o=-2*t,l=0;l<u;l++){var f=r[l];if(f&&f.length>=s){var v,d=[],p=(0,a.Z)(f);try{for(p.s();!(v=p.n()).done;){var y=v.value;d.push([y[0]+o,y[1]])}}catch(_){p.e(_)}finally{p.f()}r.push(d)}}return i?e.rings=r:e.paths=r,e}var C=(0,i.Z)((function e(t,n){(0,r.Z)(this,e),this.extent=t,this.frameIds=n})),k=(0,o.Ue)(),b=function(){function e(){(0,r.Z)(this,e),this._linesIn=[],this._linesOut=[]}return(0,i.Z)(e,[{key:"cut",value:function(e,t){var n;if(this._xCut=t,e.rings)this._closed=!0,n=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,n=e.paths,this._minPts=2}var i,r=(0,a.Z)(n);try{for(r.s();!(i=r.n()).done;){var s=i.value;if(s&&!(s.length<this._minPts)){var u,o=!0,l=(0,a.Z)(s);try{for(l.s();!(u=l.n()).done;){var h=u.value;o?(this.moveTo(h),o=!1):this.lineTo(h)}}catch(g){l.e(g)}finally{l.f()}this._closed&&this.close()}}}catch(g){r.e(g)}finally{r.f()}this._pushLineIn(),this._pushLineOut(),n=[];var c,f=(0,a.Z)(this._linesIn);try{for(f.s();!(c=f.n()).done;){var v=c.value;v&&v.length>=this._minPts&&n.push(v)}}catch(g){f.e(g)}finally{f.f()}var d,p=-2*this._xCut,y=(0,a.Z)(this._linesOut);try{for(y.s();!(d=y.n()).done;){var _=d.value;if(_&&_.length>=this._minPts){var m,x=(0,a.Z)(_);try{for(x.s();!(m=x.n()).done;){m.value[0]+=p}}catch(g){x.e(g)}finally{x.f()}n.push(_)}}}catch(g){y.e(g)}finally{y.f()}return this._closed?e.rings=n:e.paths=n,e}},{key:"moveTo",value:function(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}},{key:"lineTo",value:function(e){var t=this._side(e[0]);if(t*this._prevSide==-1){var n=this._intersect(this._prevPt,e);this._lineTo(this._xCut,n,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}},{key:"close",value:function(){var e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}},{key:"_moveTo",value:function(e,t,n){this._closed?(this._lineIn.push([n<=0?e:this._xCut,t]),this._lineOut.push([n>=0?e:this._xCut,t])):(n<=0&&this._lineIn.push([e,t]),n>=0&&this._lineOut.push([e,t]))}},{key:"_lineTo",value:function(e,t,n){this._closed?(this._addPolyVertex(this._lineIn,n<=0?e:this._xCut,t),this._addPolyVertex(this._lineOut,n>=0?e:this._xCut,t)):n<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):n>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}},{key:"_addPolyVertex",value:function(e,t,n){var i=e.length;i>1&&e[i-1][0]===t&&e[i-2][0]===t?e[i-1][1]=n:e.push([t,n])}},{key:"_checkClosingPt",value:function(e){var t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}},{key:"_side",value:function(e){return e<this._xCut?-1:e>this._xCut?1:0}},{key:"_intersect",value:function(e,t){var n=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+n*(t[1]-e[1])}},{key:"_pushLineIn",value:function(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}},{key:"_pushLineOut",value:function(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}]),e}()},54882:function(e,t,n){n.r(t),n.d(t,{default:function(){return ye}});var i=n(29439),r=n(74165),a=n(15861),s=n(37762),u=n(15671),o=n(43144),l=n(11752),h=n(61120),c=n(60136),f=n(29388),v=n(27366),d=(n(59486),n(40281)),p=n(32718),y=n(77427),_=n(92026),m=n(66978),x=n(94172),g=n(49861),w=(n(63780),n(25243),n(69912)),Z=n(65156),C=n(34066),k=n(85015),b=n(80885),S=n(52587),T=n(47991),I=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,u.Z)(this,n),t.call(this,e)}return(0,o.Z)(n,[{key:"bounds",get:function(){var e=this.coords;return(0,_.Wi)(e)||(0,_.Wi)(e.extent)?null:(0,Z.oJ)(e.extent)}},{key:"coords",get:function(){var e,t=null===(e=(0,_.Wg)(this.element.georeference))||void 0===e?void 0:e.coords;return(0,S.dz)(t,this.spatialReference).geometry}},{key:"normalizedCoords",get:function(){return b.Z.fromJSON((0,T.Ui)(this.coords))}},{key:"normalizedBounds",get:function(){var e=(0,_.pC)(this.normalizedCoords)?this.normalizedCoords.extent:null;return(0,_.pC)(e)?(0,Z.oJ)(e):null}}]),n}(k.Z);(0,v._)([(0,g.Cb)()],I.prototype,"spatialReference",void 0),(0,v._)([(0,g.Cb)()],I.prototype,"element",void 0),(0,v._)([(0,g.Cb)()],I.prototype,"bounds",null),(0,v._)([(0,g.Cb)()],I.prototype,"coords",null),(0,v._)([(0,g.Cb)()],I.prototype,"normalizedCoords",null),(0,v._)([(0,g.Cb)()],I.prototype,"normalizedBounds",null),I=(0,v._)([(0,w.j)("esri.layers.support.media.MediaElementView")],I);n(5131),n(37995),n(73828);var M=n(32344),R=n(85269),P=n(10064),O=n(98928),V=n(16889),A=n(22753),E=n(11873),D=n(88396),U=n(11186),q=(0,n(71353).c)(),W=(0,E.c)(),z=(0,E.c)(),L=(0,E.c)();function N(e,t,n){return j(z,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),j(L,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),(0,A.m)(e,(0,A.a)(z,z),L)}function j(e,t,n,r,a,s,u,o,l){(0,A.s)(e,t,r,s,n,a,u,1,1,1),(0,U.s)(q,o,l,1),(0,A.a)(W,e);var h=(0,U.t)(q,q,(0,A.t)(W,W)),c=(0,i.Z)(h,3),f=c[0],v=c[1],d=c[2];return(0,A.s)(W,f,0,0,0,v,0,0,0,d),(0,A.m)(e,W,e)}var X=n(6394),F=n(87422),B=n(44070),G=n(8548),H=n(51378),Y=n(45412),Q=n(30308),J=(0,E.c)(),$=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,u.Z)(this,n),(i=t.call(this)).elementView=e,i.isWrapAround=!1,i.perspectiveTransform=(0,X.a)(),i._vertices=new Float32Array(20),i._handles=[],i._handles.push((0,x.YP)((function(){return i.elementView.element.opacity}),(function(e){return i.opacity=e}),x.nn),(0,x.YP)((function(){return[i.elementView.coords]}),(function(){i.requestRender()}),x.nn),(0,x.gx)((function(){return i.elementView.element.loaded}),(function(){var e=i.elementView.element;i.ready(),"video"===e.type&&(0,_.pC)(e.content)&&i._handles.push((0,O.on)(e.content,"play",(function(){return i.requestRender()})))}),x.nn)),e.element.load().catch((function(t){p.Z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new P.Z("element-load-error","Element cannot be displayed",{element:e,error:t}))})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e;this._handles.forEach((function(e){return e.remove()})),null!==(e=this.texture)&&void 0!==e&&e.dispose(),this.texture=null}},{key:"dvsMat3",get:function(){return this.parent.dvsMat3}},{key:"beforeRender",value:function(e){var t=e.context,i=this.elementView.element.content;if((0,_.pC)(i)){var r=i instanceof HTMLImageElement,a=i instanceof HTMLVideoElement,s=r?i.naturalWidth:a?i.videoWidth:i.width,u=r?i.naturalHeight:a?i.videoHeight:i.height;this._updatePerspectiveTransform(s,u),this.texture?a&&!i.paused&&(this.texture.setData(i),this.requestRender(),((0,Q.Z)(t.gl)||(0,V.wt)(s)&&(0,V.wt)(u))&&this.texture.generateMipmap()):(this.texture=new H.x(t,{pixelFormat:G.VI.RGBA,dataType:G.Br.UNSIGNED_BYTE,samplingMode:G.cw.LINEAR,wrapMode:G.e8.CLAMP_TO_EDGE,width:s,height:u,preMultiplyAlpha:!0},i),((0,Q.Z)(t.gl)||(0,V.wt)(s)&&(0,V.wt)(u))&&this.texture.generateMipmap(),a&&!i.paused&&this.requestRender())}(0,l.Z)((0,h.Z)(n.prototype),"beforeRender",this).call(this,e)}},{key:"_createTransforms",value:function(){return null}},{key:"updateDrawCoords",value:function(e,t){var n=this.elementView.coords;if(!(0,_.Wi)(n)){var r=(0,i.Z)(n.rings[0],4),a=r[0],s=r[1],u=r[2],o=r[3],l=this._vertices,h=e.x,c=e.y,f=0!==t;f?l.set([s[0]-h,s[1]-c,a[0]-h,a[1]-c,u[0]-h,u[1]-c,o[0]-h,o[1]-c,o[0]-h,o[1]-c,s[0]+t-h,s[1]-c,s[0]+t-h,s[1]-c,a[0]+t-h,a[1]-c,u[0]+t-h,u[1]-c,o[0]+t-h,o[1]-c]):l.set([s[0]-h,s[1]-c,a[0]-h,a[1]-c,u[0]-h,u[1]-c,o[0]-h,o[1]-c]),this.isWrapAround=f}}},{key:"getVAO",value:function(e,t,n){if((0,_.Wi)(this.elementView.coords))return null;var i=this._vertices;if(this._vao)this._geometryVbo.setData(i);else{this._geometryVbo=B.f.createVertex(e,G.l1.DYNAMIC_DRAW,i);var r=B.f.createVertex(e,G.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new Y.U(e,n,t,{geometry:this._geometryVbo,tex:r})}return this._vao}},{key:"_updatePerspectiveTransform",value:function(e,t){var n=this._vertices;N(J,[0,0,e,0,0,t,e,t],[n[0],n[1],n[4],n[5],n[2],n[3],n[6],n[7]]),(0,D.s)(this.perspectiveTransform,J[6]/J[8]*e,J[7]/J[8]*t)}}]),n}(F.s),K=n(93433),ee=n(17842),te=n(23588),ne=n(15245),ie=n(8975),re=n(91340),ae=n(92975),se=n(86226),ue=n(98533),oe=n(80613),le=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments))._localOrigin=(0,ee.vW)(0,0),e._viewStateId=-1,e._dvsMat3=(0,te.c)(),e.requiresDedicatedFBO=!1,e}return(0,o.Z)(n,[{key:"dvsMat3",get:function(){return this._dvsMat3}},{key:"beforeRender",value:function(e){this._updateMatrices(e),this._updateOverlays(e,this.children);var t,n=(0,s.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.beforeRender(e)}}catch(i){n.e(i)}finally{n.f()}}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"overlay",brushes:[ue.U.overlay],target:function(){return t.children},drawPhase:oe.jx.MAP});return[].concat((0,K.Z)((0,l.Z)((0,h.Z)(n.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"_updateMatrices",value:function(e){var t=e.state,n=t.id,i=t.size,r=t.pixelRatio,a=t.resolution,s=t.rotation,u=t.viewpoint,o=t.displayMat3;if(this._viewStateId!==n){var l=Math.PI/180*s,h=r*i[0],c=r*i[1],f=u.targetGeometry,v=f.x,d=f.y,p=(0,re.or)(v,t.spatialReference);this._localOrigin.x=p,this._localOrigin.y=d;var y=a*h,_=a*c,m=(0,A.g)(this._dvsMat3);(0,A.m)(m,m,o),(0,A.h)(m,m,(0,ne.f)(h/2,c/2)),(0,A.d)(m,m,(0,ie.f)(h/y,-c/_,1)),(0,A.r)(m,m,-l),this._viewStateId=n}}},{key:"_updateOverlays",value:function(e,t){var n=e.state,r=n.rotation,a=n.spatialReference,u=n.worldScreenWidth,o=n.size,l=n.viewpoint,h=this._localOrigin,c=0;if(a.isWrappable){var f=o[0],v=o[1],d=180/Math.PI*r,p=Math.abs(Math.cos(d)),y=Math.abs(Math.sin(d)),m=Math.round(f*p+v*y),x=(0,i.Z)((0,ae.C5)(a).valid,2),g=x[0],w=x[1],Z=(0,se.ut)(a),C=l.targetGeometry,k=C.x,b=[k,C.y],S=[0,0];n.toScreen(S,b);var T,I=[0,0];T=m>u?.5*u:.5*m;var M=Math.floor((k+.5*Z)/Z),R=g+M*Z,P=w+M*Z,O=[S[0]+T,0];n.toMap(I,O),I[0]>P&&(c=Z),O[0]=S[0]-T,n.toMap(I,O),I[0]<R&&(c=-Z);var V,A=(0,s.Z)(t);try{for(A.s();!(V=A.n()).done;){var E=V.value,D=E.elementView.bounds;if(!(0,_.Wi)(D)){var U=(0,i.Z)(D,3),q=U[0],W=U[2];q<g&&W>g?E.updateDrawCoords(h,Z):W>w&&q<w?E.updateDrawCoords(h,-Z):E.updateDrawCoords(h,c)}}}catch(N){A.e(N)}finally{A.f()}}else{var z,L=(0,s.Z)(t);try{for(L.s();!(z=L.n()).done;){z.value.updateDrawCoords(h,c)}}catch(N){L.e(N)}finally{L.f()}}}}]),n}(n(64510).Z),he=n(95986),ce=n(67581),fe=n(53866),ve=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments))._overlayContainer=null,e._fetchQueue=null,e._tileStrategy=null,e._elementReferences=new Map,e.layer=null,e.elements=new d.Z,e}return(0,o.Z)(n,[{key:"attach",value:function(){var e=this;this.handles.add((0,x.on)((function(){return e.layer.source}),"refresh",(function(){var t,n=(0,s.Z)(e._tileStrategy.tiles);try{for(n.s();!(t=n.n()).done;){var i=t.value;e._updateTile(i)}}catch(r){n.e(r)}finally{n.f()}e.requestUpdate()}))),this._overlayContainer=new le,this.container.addChild(this._overlayContainer),this._fetchQueue=new M.Z({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:function(t,n){return e._queryElements(t,n)}}),this._tileStrategy=new R.Z({cachePolicy:"purge",resampling:!0,acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}},{key:"detach",value:function(){this.handles.removeAll(),this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear()}},{key:"supportsSpatialReference",value:function(e){return!0}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"update",value:function(e){this._tileStrategy.update(e)}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,u,o,l,h,c,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=t.normalize(),u=[a.x,a.y],o=(0,s.Z)(this._elementReferences.values());try{for(o.s();!(l=o.n()).done;)h=l.value.projectedElement,c=h.normalizedCoords,f=h.element,(0,_.pC)(c)&&(0,C.wP)(c.rings,u)&&i.push({type:"media",element:f,layer:this.layer,mapPoint:t})}catch(n){o.e(n)}finally{o.f()}return e.abrupt("return",i.reverse());case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return null!=this.layer.source&&(0,l.Z)((0,h.Z)(n.prototype),"canResume",this).call(this)}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_acquireTile",value:function(e){var t=new pe(e.clone());return this._updateTile(t),t}},{key:"_updateTile",value:function(e){var t=this;this.updatingHandles.addPromise(this._fetchQueue.push(e.key).then((function(n){var r=e.setElements(n),a=(0,i.Z)(r,2),s=a[0],u=a[1];t._acquireElements(e,s),t._releaseElements(e,u),t.requestUpdate()}),(function(e){(0,m.D_)(e)||p.Z.getLogger(t.declaredClass).error(e)})))}},{key:"_releaseTile",value:function(e){this._fetchQueue.abort(e.key.id),e.elements&&this._releaseElements(e,e.elements),this.requestUpdate()}},{key:"_queryElements",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.source,!(0,_.Wi)(i)){e.next=3;break}return e.abrupt("return",[]);case 3:return this.view.featuresTilingScheme.getTileBounds(de,t,!0),a=new fe.Z({xmin:de[0],ymin:de[1],xmax:de[2],ymax:de[3],spatialReference:this.view.spatialReference}),e.abrupt("return",i.queryElements(a,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_acquireElements",value:function(e,t){var n=this,i=this.layer.source,r=this.view.spatialReference;if(!(0,_.Wi)(i)){var a,u=(0,s.Z)(t);try{var o=function(){var t=a.value;(0,y.s1)(n._elementReferences,t.uid,(function(){var e=new I({element:t,spatialReference:r}),i=new $(e);return n._overlayContainer.addChild(i),n.elements.add(t),{tiles:new Set,projectedElement:e,overlay:i}})).tiles.add(e)};for(u.s();!(a=u.n()).done;)o()}catch(l){u.e(l)}finally{u.f()}}}},{key:"_releaseElements",value:function(e,t){var n,i=(0,s.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this._elementReferences.get(r.uid);a.tiles.delete(e),a.tiles.size||(this._overlayContainer.removeChild(a.overlay),a.overlay.destroy(),a.projectedElement.destroy(),this._elementReferences.delete(r.uid),this.elements.remove(r))}}catch(u){i.e(u)}finally{i.f()}}}]),n}((0,he.y)(ce.Z));(0,v._)([(0,g.Cb)()],ve.prototype,"_fetchQueue",void 0),(0,v._)([(0,g.Cb)()],ve.prototype,"layer",void 0),(0,v._)([(0,g.Cb)({readOnly:!0})],ve.prototype,"elements",void 0),ve=(0,v._)([(0,w.j)("esri.views.2d.layers.MediaLayerView2D")],ve);var de=(0,Z.Ue)(),pe=function(){function e(t){(0,u.Z)(this,e),this.key=t,this.elements=null,this.isReady=!1,this.visible=!0}return(0,o.Z)(e,[{key:"setElements",value:function(e){var t=[],n=new Set(this.elements);this.elements=e;var i,r=(0,s.Z)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;n.has(a)?n.delete(a):t.push(a)}}catch(u){r.e(u)}finally{r.f()}return this.isReady=!0,[t,Array.from(n)]}}]),e}(),ye=ve}}]);
//# sourceMappingURL=4882.d6f74560.chunk.js.map