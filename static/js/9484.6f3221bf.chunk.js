"use strict";(self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD=self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD||[]).push([[9484],{8827:function(e,t,r){r.d(t,{i:function(){return o}});var i=r(15671),n=r(43144),a=r(25290),s=r(81434),o=function(){function e(){(0,i.Z)(this,e)}return(0,n.Z)(e,null,[{key:"getPlacement",value:function(e,t,r,i){var n=(0,s.W)(t);if(!n)return null;var o=(0,a.GP)(e);return n.execute(o,t,r,i)}}]),e}()},72774:function(e,t,r){r.d(t,{_:function(){return x}});var i=r(4942),n=r(15671),a=r(43144),s=(r(5131),r(37995),r(73828)),o=(r(32344),r(85269),r(94109)),u=r(84328),l=r(80613),h=r(46640),c=new Map;function f(e,t,r){var i=c.get(e),n=i.indicesPerRecord,a=i.multiplier,s=i.verticesPerRecord;return{recordBytes:r*o.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*n*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*s*r*t}}c.set(l.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),c.set(l.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),c.set(l.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),c.set(l.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),c.set(l.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var v=r(27446),_=function(){function e(t,r,i){(0,n.Z)(this,e),this._start={index:0,vertex:0};var a=f(t,r,i),s=r/4;this.geometryType=t,this._records=new v.Z(Int32Array,a.recordBytes),this._indices=new v.Z(Uint32Array,a.indexBytes),this._vertices=new v.Z(Uint32Array,a.vertexBytes),this._metrics=new v.Z(Float32Array,0),this._strideInt=s}return(0,a.Z)(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,i),{stride:a,records:t,indices:r,vertices:i,metrics:n}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/o.XJ}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,i,n,a,s,o){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(i),this._records.push(n),this._records.push(a),this._records.push(s),this._records.writeF32(o)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var i=e._records.length-o.XJ,n=e._records.getValue(i),a=e._records.getValue(i+1),s=e._records.getValue(i+2),u=e._records.getValue(i+4),l=e._records.getValue(i+6),h=e._records.getValue(i+7),c=this._vertices.length,f=(e._start.vertex-this._vertices.length)/this._strideInt,v=this._indices.length,_=this.vertexCount,d=e._start.index;d!==e._indices.length;d++){var y=e._indices.getValue(d);this._indices.push(y-f)}for(var p=e._start.vertex;p!==e._vertices.length;p++){var m=e._vertices.getValue(p);this._vertices.push(m)}for(var x=c;x<=this._vertices.length;x+=this._strideInt)this._vertices.i1616Add(x,t,r);this._records.push(n),this._records.push(a),this._records.push(s),this._records.push(v),this._records.push(u),this._records.push(_),this._records.push(l),this._records.push(h)}}]),e}(),d=r(35092),y=128;function p(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case y:return 1}}function m(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case y:return 1}}var x=function(){function e(t,r,i,a,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,n.Z)(this,e),this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasAggregate=a,this._pixelBufferEnabled=s,this._version=o,this._symbologyType=i}return(0,a.Z)(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(i,n){var a=1<<n,o=p(a),u=m(a),l=(0,d.M)(new s.Z(t.tileKey),o,u,e),h=t._serializeTileVertexData(t.tileKey,l.id,i.vertexData);h.message.bufferIds=i.displayIds,r.push(h)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var n,a,s,o,u,h,c=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(h={},(0,i.Z)(h,l.LW.MARKER,null===(n=r.get(l.LW.MARKER))||void 0===n?void 0:n.serialize(c)),(0,i.Z)(h,l.LW.FILL,null===(a=r.get(l.LW.FILL))||void 0===a?void 0:a.serialize(c)),(0,i.Z)(h,l.LW.LINE,null===(s=r.get(l.LW.LINE))||void 0===s?void 0:s.serialize(c)),(0,i.Z)(h,l.LW.TEXT,null===(o=r.get(l.LW.TEXT))||void 0===o?void 0:o.serialize(c)),(0,i.Z)(h,l.LW.LABEL,null===(u=r.get(l.LW.LABEL))||void 0===u?void 0:u.serialize(c)),h),version:this._version},transferList:c}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,i){this._current.writer=this._getVertexWriter(r),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=i,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,i){this._current.bufferingEnabled&&this._addOverlap(e,t,r,i)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,i,n,a,s,o){this._current.writer=this._getVertexWriter(l.LW.LABEL);var h=this._current.writer.metricWriter;h.push((0,u.jL)(e)),h.push(t),h.push(r),h.push(i),h.push(n),h.push(a),h.push(s),h.push(o),h.push(255),this._current.metricBoxLenPointer=h.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,i){var n=this._current.writer.metricWriter;n.incr(this._current.metricBoxLenPointer),n.push(0),n.push(0),n.push(e),n.push(t),n.push(r),n.push(i)}},{key:"recordEnd",value:function(){var e=this._current.vertStart,t=this._current.writer.vertexCount-e;if(!t)return!1;this.hasRecords=!0;var r=this._current.indexStart,i=this._current.writer.indexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,r,i,e,t,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===l.LW.LABEL)return!0;for(var n=this._current.writer,a=0;a<8;a++){var s=1<<a;if(this._current.overlaps&s){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});var u=this._data.neighbors[a],c=this._current.geometryType;if(!u.vertexData.has(c)){var f=(0,h.$_)(c,this._symbologyType).geometry,v=new _(c,f,o.Ip);u.vertexData.set(c,v)}var d=u.vertexData.get(this._current.geometryType),y=512*-p(s)*8,x=512*-m(s)*8;d.copyLastFrom(n,y,x),u.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,i){var n=255^((e<0+r?148:e>=o.I_-r?41:189)|(t<0+i?224:t>=o.I_-i?7:231));this._current.overlaps|=n}},{key:"_getVertexWriter",value:function(e){if(!this._data.self.has(e)){var t=this._data.self,r=(0,h.$_)(e,this._symbologyType).geometry;t.set(e,new _(e,r,this.hint.records))}return this._data.self.get(e)}}]),e}()},74017:function(e,t,r){r.d(t,{j:function(){return O}});var i=r(74165),n=r(15861),a=r(37762),s=r(15671),o=r(43144),u=(r(93169),r(92026)),l=r(66978),h=r(48035),c=r(84328),f=r(29439),v=r(60136),_=r(29388),d=r(10064),y=r(32718),p=r(16889),m=r(17842),x=r(48202),g=r(38999),M=r(65800),k=r(94109),w=r(80613),Z=r(73271),b=r(54815),L=r(42093);function S(e,t){return e[t+1]}function W(e){return e.length-1}function P(e){for(var t=0,r=0;r<W(e);r++)t+=I(e,r);return t}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=S(e,t),n=(0,f.Z)(i,2),a=n[0],s=n[1];return Math.sqrt(a*a+s*s)*r}var T=function(){function e(t,r,i,n,a){(0,s.Z)(this,e),this._segments=t,this._index=r,this._distance=i,this._xStart=n,this._yStart=a,this._done=!1}return(0,o.Z)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<W(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var i=this.backwardLength;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function z(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=P(e),a=T.create(e),s=n/2;if(!i)return a.seek(s),void r(a.clone(),0,s+0*t,n);var o=Math.max((n-t)/2,0),u=Math.floor(o/t),l=s-u*t;a.seek(l);for(var h=-u;h<=u;h++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&r(a.clone(),h,s+h*t,n),a.seek(t)}function F(e,t){var r=1e-6;if(!(t<=0)){var i=e.length;if(!(i<3)){var n=[],a=0;n.push(0);for(var s=1;s<i;s++)a+=(0,L.TK)(e[s],e[s-1]),n.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var u=e[i-1][0],l=e[i-1][1],h=(0,L.lu)([0,0],e[0],e[1]);(0,L.Fv)(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],(0,L.lu)(h,e[i-1],e[i-2]),(0,L.Fv)(h),e[i-1][0]+=t*h[0],e[i-1][1]+=t*h[1];for(var c=1;c<i;c++)n[c]+=t;n[i-1]+=t;for(var f=.5*t,v=1;v<i-1;v++){for(var _=0,d=0,y=0,p=v-1;p>=0&&!(n[p+1]<n[v]-f);p--){var m=f+n[p+1]-n[v],x=n[p+1]-n[p],g=n[v]-n[p]<f?1:m/x;if(Math.abs(g)<r)break;var M=g*g,k=g*m-.5*M*x,w=g*x/t,Z=e[p+1],b=e[p][0]-Z[0],S=e[p][1]-Z[1];_+=w/k*(Z[0]*g*m+.5*M*(m*b-x*Z[0])-M*g*x*b/3),d+=w/k*(Z[1]*g*m+.5*M*(m*S-x*Z[1])-M*g*x*S/3),y+=w}for(var W=v+1;W<i&&!(n[W-1]>n[v]+f);W++){var P=f-n[W-1]+n[v],I=n[W]-n[W-1],T=n[W]-n[v]<f?1:P/I;if(Math.abs(T)<r)break;var z=T*T,F=T*P-.5*z*I,C=T*I/t,A=e[W-1],E=e[W][0]-A[0],R=e[W][1]-A[1];_+=C/F*(A[0]*T*P+.5*z*(P*E-I*A[0])-z*T*I*E/3),d+=C/F*(A[1]*T*P+.5*z*(P*R-I*A[1])-z*T*I*R/3),y+=C}o.push(_/y),o.push(d/y)}o.push(u),o.push(l);for(var B=0,D=0;B<i;B++)e[B][0]=o[D++],e[B][1]=o[D++]}}}var C=r(27344),A=y.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var E=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}((function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),R=function(e){return Math.floor(127*e+127)},B=function(e){return Math.floor(10*e)},D=function(e){return Math.round(e*(254/360))},U=function(e){(0,v.Z)(r,e);var t=(0,_.Z)(r);function r(e,i,n,a){var o,u,l,h;(0,s.Z)(this,r),(h=t.call(this,e,n.font.size,n.haloSize||0,n.font.size,n.color&&(0,M.aH)(n.color)||0,n.haloColor&&(0,M.aH)(n.haloColor)||0,n.horizontalAlignment,n.verticalAlignment,(0,g.NS)(i.labelPlacement)?x.v2.MAP:x.v2.SCREEN,n.font.decoration,!1,n.angle||0,n.xoffset,n.yoffset,n.lineWidth,n.lineHeight,null,null,null,null,null))._outLineLabelAngle=0,h._refPlacementPadding=0,h._refPlacementDirX=0,h._refPlacementDirY=0,h._refOffsetX=0,h._refOffsetY=0,h._zoomLevel=0,h.geometryType=w.LW.LABEL,h._allowOverrun=null!==(o=i.allowOverrun)&&void 0!==o&&o,h._repeatLabel=null===(u=i.repeatLabel)||void 0===u||u,h._labelPosition=null!==(l=i.labelPosition)&&void 0!==l?l:"curved";var c=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return(0,p.uZ)(r,0,25.5)}(i,a),v=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return(0,p.uZ)(r,0,25.5)}(i,a),_=i.labelPlacement,d=(0,g.qv)(_),y=(0,f.Z)(d,2),Z=y[0],L=y[1];h._xAlignD=Z,h._yAlignD=L,h._minZoom=c,h._maxZoom=v,h._refPlacementPadding=(0,m.F2)(n.haloSize)+k.Iw,h._repeatLabelDistance=i.repeatLabelDistance?(0,m.F2)(i.repeatLabelDistance):128;var S=b.Gq.load(e);return S.sdf=!0,h._materialKey=S.data,h}return(0,o.Z)(r,[{key:"_shapedBox",get:function(){return(0,u.Wg)(this._shapingInfo).bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=(0,g.g)(this._xAlignD),r=(0,g.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,u.Wi)(e))this._refSymbolAndPlacementOffset=(0,Z.Jz)(0,0,R(t),R(r));else{if("circle"===e.boundsType&&(t||r)){var i=Math.sqrt(t*t+r*r);t/=i,r/=i}var n=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=(0,Z.Jz)(a,n,R(t),R(r)),this._referenceSize=n,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"_write",value:function(e,t){if(!(0,u.Wi)(this._shapingInfo)){var r=this._shapingInfo,i=t.getDisplayId(),n="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(n)switch(this._current={out:e,inId:i,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(n);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(n);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";A.error(new d.Z(t,e))}("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=B(this._current.zoomLevel);return B(e)<=r&&r<=B(t)}},{key:"_placePointLabels",value:function(e){var t=this._current,r=t.out,i=t.inId,n=t.inShaping;this._writeGlyphs(r,i,e,n)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,i=0;i<e.length;i++){var n=e[i],a=[];a.push(n[0]);for(var s=1;s<n.length;s++){var o=(0,f.Z)(a[s-1],2),u=o[0],l=o[1];u+=n[s][0],l+=n[s][1],a.push([u,l])}F(a,r);var h=[];h.push(a[0]);for(var c=1;c<a.length;c++){var v=(0,f.Z)(a[c-1],2),_=v[0],d=v[1],y=(0,f.Z)(a[c],2),p=y[0],m=y[1],x=Math.round(p-_),g=Math.round(m-d);h.push([x,g])}e[i]=h,n=h}return e}(e.paths,this._current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),n=(this._shapedBox.width+this._repeatLabelDistance)/2,s=(0,a.Z)(r);try{for(s.s();!(t=s.n()).done;){z(t.value,n,i,this._repeatLabel)}}catch(o){s.e(o)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,i){var n=E(t),a=this._shapedBox.width/2,s=Math.sqrt(this._repeatLabelDistance)/2,o=Math.min(r,i-r),u=this._current.inShaping.isMultiline?25:Math.log2(o/(s+a/2)),l=0===t?u:Math.min(n,u),h=Math.max(this._minZoom,this._current.zoomLevel+1-l),c=this._current.zoomLevel-h,f=this._shapedBox.width/2*Math.pow(2,c);this._current.inShaping.isMultiline?0===t&&this._placeStraight(e,h):this._allowOverrun&&c<0?this._placeStraightAlong(e,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(e,h):"curved"===this._labelPosition&&this._placeCurved(e,h,f)}},{key:"_placeStraight",value:function(e,t){var r=this._current,i=r.out,n=r.inId,a=r.inShaping,s=Math.ceil(e.angle*(180/Math.PI)%360),o=Math.ceil((e.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=D(s),this._writeGlyphs(i,n,e,a,t),this._outLineLabelAngle=D(o),this._writeGlyphs(i,n,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var i=this._current,n=i.out,a=i.inId;n.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,u=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=D(o),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=D(u),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),n.metricEnd()}},{key:"_placeStraightAlong",value:function(e,t){var r=this._current,i=r.out,n=r.inId;i.metricStart(n,t,e.x,e.y,0,0,0,0);var a=e.clone(),s=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=D(s),this._placeFirst(a,t,1,!0),this._outLineLabelAngle=D(o),this._placeFirst(a,t,0,!0),i.metricEnd()}},{key:"_placeBack",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=i);)this._placeOnSegment(a,t,s,r,-1,n),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=i);)this._placeOnSegment(a,t,s,r,1,n),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=e,o=this._current.inShaping,u=o.glyphs,l=this._current.zoomLevel,h=this._current,c=h.out,f=h.inId,v=(0,a.Z)(u);try{for(v.s();!(i=v.n()).done;){var _=i.value,d=_.x>o.bounds.x?r:1-r,y=d*e.remainingLength+(1-d)*e.backwardLength,p=Math.abs(_.x+_.width/2-o.bounds.x),m=Math.max(0,l+Math.log2(p/(y+0))),x=Math.max(t,n?0:m);if(_.maxZoom=25,_.angle=e.angle+(1-r)*Math.PI,_.minZoom=x,this._writeGlyph(c,f,s.x,s.y,_),r&&this._isVisible(_.minZoom,_.maxZoom)){var g=_.bounds;c.metricBoxWrite(g.center[0],g.center[1],g.width,g.height)}}}catch(M){v.e(M)}finally{v.f()}}},{key:"_placeOnSegment",value:function(e,t,r,i,n,s){var o,u=this._current.inShaping.glyphs,l=this._current,h=l.out,c=l.inId,f=this._current.inShaping,v=this._current.zoomLevel,_=e.dx/e.length,d=e.dy/e.length,y={x:e.x+r*-n*_,y:e.y+r*-n*d},p=(0,a.Z)(u);try{for(p.s();!(o=p.n()).done;){var m=o.value,x=m.x>f.bounds.x?s:1-s;if(x&&1===n||!x&&-1===n){var g=Math.abs(m.x+m.width/2-f.bounds.x),M=Math.max(0,v+Math.log2(g/r)-.1),k=Math.max(i,v+Math.log2(g/(r+e.length+0)));if(0!==M&&(m.angle=e.angle+(1-s)*Math.PI,m.minZoom=k,m.maxZoom=M,this._writeGlyph(h,c,y.x,y.y,m),s&&this._isVisible(m.minZoom,m.maxZoom))){var w=m.bounds,Z=e.x-t.x,b=e.y-t.y;h.metricBoxWrite(w.center[0]+Z,w.center[1]+b,w.width,w.height)}}}}catch(L){p.e(L)}finally{p.f()}}},{key:"_writeGlyphs",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var s,o=r.x+this._refOffsetX,u=r.y-this._refOffsetY,l=(0,a.Z)(i.glyphs);try{for(l.s();!(s=l.n()).done;){var h=s.value;h.minZoom=n,h.maxZoom=this._maxZoom,this._writeGlyph(e,t,o,u,h)}}catch(_){l.e(_)}finally{l.f()}var c=this._refPlacementDirX,f=this._refPlacementDirY,v=i.boundsT;e.metricStart(t,n,o,u,c,f,this._referenceSize,this._materialKey),e.metricBoxWrite(v.center[0],v.center[1],v.width,v.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,Z.Jz)(0,0,this._size,this._haloSize),o=Math.max(i.minZoom,this._minZoom),u=Math.min(i.maxZoom,this._maxZoom),l=(0,Z.Jz)(B(o),B(u),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(l)}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var i=e.symbol;i.xoffset=0,i.yoffset=0,i.angle=0,i.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(C.Z),V=r(64580),G=r(61909),O=function(){function e(t,r,i){(0,s.Z)(this,e),this._loadPromise=(0,h.j)(),this._geometryType=t,this._idField=r,this._templateStore=i}return(0,o.Z)(e,[{key:"update",value:function(e,t){(0,u.pC)(e.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var i,n=(0,a.Z)(e.classes);try{for(n.s();!(i=n.n()).done;){var s=i.value,o=U.fromLabelClass(s,t);r.set(s.index,o)}}catch(_){n.e(_)}finally{n.f()}return r}for(var u in e.classes){var l,h=e.classes[u],c=(0,a.Z)(h);try{for(c.s();!(l=c.n()).done;){var f=l.value,v=U.fromLabelClass(f,t);r.set(f.index,v)}}catch(_){c.e(_)}finally{c.f()}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,n,s,o,h,f){var v,_,d,y,p,m,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,l.Hc)(f)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===n.type,!e.t0){e.next=7;break}return e.next=6,n.analyze(this._idField,t.copy(),r,o,h,f);case 6:v=e.sent;case 7:for(_=0;t.next();)if(void 0,d=v?v[_++]:(0,u.pC)(s)&&(0,c.nE)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?s.match(this._idField,t,this._geometryType,o,h):n.match(this._idField,t,this._geometryType,o,h),t.setGroupId(d),(0,G.Sl)(d)){y=this._templateStore.getDynamicTemplateGroup(d),p=(0,a.Z)(y);try{for(p.s();!(m=p.n()).done;)(x=m.value)&&x.analyze&&x.analyze(this._templateStore,t,o,h)}catch(i){p.e(i)}finally{p.f()}}return e.next=11,this._loadPromise;case 11:return e.abrupt("return",this._templateStore.finalize(f));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s,o){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,n,s,o,u){var h,c,f,v,_,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,l.Hc)(u)){e.next=2;break}return e.abrupt("return");case 2:if(h=t.getCursor(),e.t0=n,!e.t0){e.next=7;break}return e.next=7,n.analyze(this._idField,h.copy(),r,s,o,u);case 7:if(!h.next()){e.next=13;break}if(null!=(c=h.getGroupId())&&-1!==c||(c=n.match(this._idField,h,h.geometryType,s,o),h.setGroupId(c)),(0,G.Sl)(c)){f=this._templateStore.getDynamicTemplateGroup(c),v=(0,a.Z)(f);try{for(v.s();!(_=v.n()).done;)(d=_.value)&&d.analyze&&d.analyze(this._templateStore,h,s,o)}catch(i){v.e(i)}finally{v.f()}}h.setGroupId(c);case 11:e.next=7;break;case 13:return e.next=15,this._loadPromise;case 15:return e.abrupt("return",this._templateStore.finalize(u));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t,r,i){var n=t.getGroupId(),s=t.getDisplayId(),o=this._templateStore.getTemplateGroup(n);if(e.featureStart(t.insertAfter,0),null!=s){if((0,G.Sl)(n)){var u,l=(0,a.Z)(o);try{for(l.s();!(u=l.n()).done;){var h=u.value;h&&h.bindFeature(t,null,null)}}catch(_){l.e(_)}finally{l.f()}}if(o){var c,f=(0,a.Z)(o);try{for(f.s();!(c=f.n()).done;){var v=c.value;v&&v.write(e,t,r,i)}}catch(_){f.e(_)}finally{f.f()}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,i,n,s,o){var l=t.getGroupId(),h=t.getDisplayId(),c=this._templateStore.getTemplateGroup(l),f=this._schema.mesh.sortKey,v=0;if((0,u.pC)(f)&&(v=null!=f.fieldIndex?t.getComputedNumericAtIndex(f.fieldIndex):null!=f.field?t.readAttribute(f.field):t.readAttribute(this._idField),v*="asc"===f.order?1:-1),e.featureStart(0,null==v||isNaN(v)?0:v),null!=h&&c){if((0,G.Sl)(l)){var _,d=(0,a.Z)(c);try{for(d.s();!(_=d.n()).done;){_.value.bindFeature(t,r,i)}}catch(x){d.e(x)}finally{d.f()}}var y,p=(0,a.Z)(c);try{for(p.s();!(y=p.n()).done;){y.value.write(e,t,n,o)}}catch(x){p.e(x)}finally{p.f()}if((0,u.pC)(s)&&e.hasRecords){var m=s&&this._findLabelRef(c);this._writeLabels(e,t,s,m,n,o)}e.featureEnd()}}},{key:"_findLabelRef",value:function(e){var t,r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i instanceof V.Z)return i}}catch(n){r.e(n)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,i,n,s){var o,l=(0,a.Z)(r);try{for(l.s();!(o=l.n()).done;){var h=o.value;if((0,u.pC)(h)&&h){var c=h.glyphs,f=h.rtl,v=h.index,_=this._labelTemplates.get(v);_.setZoomLevel(n),_.bindReferenceTemplate(i),_.bindTextInfo(c,f),_.write(e,t,null,s)}}}catch(d){l.e(d)}finally{l.f()}}}]),e}()},59697:function(e,t,r){r.d(t,{Z:function(){return M}});var i=r(29439),n=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(92026),l=r(17842),h=r(22018),c=r(11245),f=r(88396),v=r(15245),_=r(83406),d=r(8827),y=r(94109),p=r(80613),m=r(73271),x=r(54815),g=3.14159265359/180,M=function(e){return function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e._vertexBoundsScaleX=1,e._vertexBoundsScaleY=1,e._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},e.geometryType=p.LW.MARKER,e}return(0,a.Z)(r,[{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();e.recordStart(n,this._materialKey,this.geometryType,!0),this._writeGeometry(e,t,n,r,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n,a){var s=this;if((0,u.pC)(this._markerPlacement))return this._writePlacedMarkers(e,t,n,a);if(!a&&"esriGeometryPoint"===t.geometryType){var o=t.getX(),l=t.getY();if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(o<0||o>=513||l<0||l>=513))return;return this._writeVertices(e,r,this._getPos(o,l),o,l)}var h=a?(0,_.oB)((0,_.GH)(a),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,u.Wi)(h)){if(h.isPoint){var c=(0,i.Z)(h.coords,2),f=c[0],v=c[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(f<0||f>=512||v<0||v>=512))return;return this._writeVertices(e,r,this._getPos(f,v),f,v)}h.forEachVertex((function(t,i){var n=2*y.I_;t<-n||t>=n||i<-n||i>=n||s._writeVertices(e,r,s._getPos(t,i),t,i)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r,i){var n=null!==i&&void 0!==i?i:t.readLegacyGeometryForDisplay(),a=d.i.getPlacement(n,(0,u.Wg)(this._markerPlacement),(0,l.F2)(1),r.geometryEngine);if(a)for(var s=t.getDisplayId(),o=(0,v.c)(),h=(0,c.c)(),f=a.next();null!=f;){var _=f.tx,y=-f.ty;_>=-128&&_<=640&&y>=-128&&y<=640&&(this._applyTransformation(h,o,-f.getAngle()/g),this._writeVertices(e,s,this._getPos(_,y),_,y)),f=a.next()}}},{key:"_writeVertices",value:function(e,t,r,i,n){var a=x.mE.load(this._materialKey);return a.symbologyType===p.mD.HEATMAP?this._writeHeatmapVertices(e,t,r):this._writeMarkerVertices(e,t,a,r,i,n)}},{key:"_writeMarkerVertices",value:function(e,t,r,i,n,a){var s=r.vvRotation,o=e.vertexCount(),u=this._computedWidth*this._vertexBoundsScaleX,l=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){var h=Math.max(u,l);u=h,l=h}if(s){var c=Math.max(this.xOffset,this.yOffset);u+=c,l+=c}e.vertexBounds(n+this.xOffset,a-this.yOffset,u,l),e.vertexWrite(i),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(i),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(i),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(i),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),this._writeIndices(e,o)}},{key:"_writeHeatmapVertices",value:function(e,t,r){var i=e.vertexCount();e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(t),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(t),e.vertexEnd(),this._writeIndices(e,i)}},{key:"_writeIndices",value:function(e,t){e.indexWrite(t+0),e.indexWrite(t+1),e.indexWrite(t+2),e.indexWrite(t+1),e.indexWrite(t+3),e.indexWrite(t+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,h.a)(e,(0,v.f)(this.xOffset,-this.yOffset)),this.angle+r!==0&&(0,h.r)(e,e,g*(this.angle+r));var i=this._computedWidth,n=this._computedHeight,a=-(.5+this._anchorX)*i,s=-(.5-this._anchorY)*n;(0,f.s)(t,a,s),(0,f.t)(t,t,e),this._offsetUpperLeft=(0,m.UJ)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],(0,f.s)(t,a+i,s),(0,f.t)(t,t,e),this._offsetUpperRight=(0,m.UJ)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],(0,f.s)(t,a,s+n),(0,f.t)(t,t,e),this._offsetBottomLeft=(0,m.UJ)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],(0,f.s)(t,a+i,s+n),(0,f.t)(t,t,e),this._offsetBottomRight=(0,m.UJ)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}},{key:"_getPos",value:function(e,t){return(0,m.UJ)(Math.round(8*e),Math.round(8*t))}}]),r}(e)}},5748:function(e,t,r){r.d(t,{Z:function(){return m}});var i=r(37762),n=r(29439),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(92026),h=r(17842),c=r(83406),f=r(8827),v=r(94109),_=r(80613),d=r(73271),y=r(54815),p=r(47975),m=function(e){return function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n)))._isCIM=!1,e._vertexBoundsScale=1,e.geometryType=_.LW.TEXT,e._aux=(0,d.Jz)(0,0,e._referenceSize,e._bitset),e}return(0,s.Z)(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=(0,l.yw)(e,(function(e){return(0,p.Nr)(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:v.xm*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();this._writeGeometry(e,t,n,r,i)}},{key:"_writeGeometry",value:function(e,t,r,i,a){var s=this,o=this._shapingInfo;if(!(0,l.Wi)(o)){if((0,l.pC)(this._textPlacement)){var u=null!==a&&void 0!==a?a:t.readLegacyGeometryForDisplay();return this._writePlacedText(e,r,u,o,i)}var h=a?(0,c.oB)((0,c.GH)(a),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,l.Wi)(h)){if(h.isPoint){var f=(0,n.Z)(h.coords,2),v=f[0],_=f[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(v<0||v>=512||_<0||_>=512))return;return this._writeGlyphs(e,r,{x:v,y:_},o)}h.forEachVertex((function(t,i){return s._writeGlyphs(e,r,{x:t,y:i},o)}))}}}},{key:"_writePlacedText",value:function(e,t,r,i,n){var a=(0,l.Wg)(this._textPlacement),s=f.i.getPlacement(r,a,(0,h.F2)(1),n.geometryEngine);if(s)for(var o=s.next();null!=o;){var u=-o.getAngle();i.setRotation(u);var c=o.tx,v=-o.ty;c<0||c>=512||v<0||v>=512||(this._writeGlyphs(e,t,{x:c,y:v},i),i.setRotation(-u)),o=s.next()}}},{key:"_writeGlyphs",value:function(e,t,r,n){var a,s=y.m2.load(this._materialKey),o=(0,d.UJ)(Math.round(8*r.x),Math.round(8*r.y)),u=this._vertexBoundsScale,l=n.bounds,h=2*Math.max(l.width,l.height),c=(0,i.Z)(n.glyphs);try{for(c.s();!(a=c.n()).done;){var f=a.value;s.textureBinding=f.textureBinding,e.recordStart(t,s.data,this.geometryType,!0),e.vertexBounds(r.x+l.x+this._xOffset,r.y+l.y-this._yOffset,h*u,h*u),this._writeVertices(e,t,o,f),e.recordEnd()}}catch(v){c.e(v)}finally{c.f()}}},{key:"_writeGlyph",value:function(e,t,r,i,n){var a=y.m2.load(this._materialKey),s=(0,d.UJ)(Math.round(8*r),Math.round(8*i));a.textureBinding=n.textureBinding,e.recordStart(t,a.data,this.geometryType,!0);var o=n.bounds,u=this._vertexBoundsScale;e.vertexBounds(r+o.x*u,i+o.y*u,o.width*u,o.height*u),this._writeVertices(e,t,s,n),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,i){var n=e.vertexCount();this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperLeft),e.vertexWrite(i.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperRight),e.vertexWrite(i.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerLeft),e.vertexWrite(i.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerRight),e.vertexWrite(i.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,d.Jz)(0,0,this._referenceSize,this._bitset),o=(0,d.Jz)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}}]),r}(e)}},64580:function(e,t,r){r.d(t,{Z:function(){return M}});var i=r(29439),n=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(92026),l=r(17842),h=r(11245),c=r(15245),f=r(48202),v=r(65800),_=r(94109),d=r(80613),y=r(73271),p=r(54815),m=r(42093),x=r(59697),g=r(52993),M=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a,s,o,u,l,v,m,x,g,M,k,w,Z,b,L,S,W,P,I,T,z){var F;(0,n.Z)(this,r),(F=t.call(this)).angle=s,F.height=l,F.width=u,F.xOffset=i*W,F.yOffset=a*W,F._markerPlacement=P,F._effects=I,F._anchorX=b,F._anchorY=L,F._minMaxZoom=(0,y.UJ)(Math.round(T*_.MI),Math.round(z*_.MI));var C=(w===f.v2.MAP?_.Tz:_.CQ)|(g?_.Uh:0)|(k?_.oK:0)|(M?_.e0:0),A=Z&&Z.sdf,E=p.mE.load(e);E.sdf=A,E.pattern=!0,E.textureBinding=Z.textureBinding,F._materialKey=E.data,F._fillColor=o,F._outlineColor=m,F._sizeOutlineWidth=(0,y.Jz)(Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*l),255)),Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*v),255)));var R=Z.rect.x+_.fL,B=Z.rect.y+_.fL,D=R+Z.width,U=B+Z.height;F._offsets.xUpperLeft=R,F._offsets.yUpperLeft=B,F._offsets.xUpperRight=D,F._offsets.yUpperRight=B,F._offsets.xBottomLeft=R,F._offsets.yBottomLeft=U,F._offsets.xBottomRight=D,F._offsets.yBottomRight=U,E.symbologyType===d.mD.PIE_CHART?(F._texUpperLeft=(0,y.UJ)(0,1),F._texUpperRight=(0,y.UJ)(1,1),F._texBottomLeft=(0,y.UJ)(0,0),F._texBottomRight=(0,y.UJ)(1,0)):(F._texUpperLeft=(0,y.UJ)(R,B),F._texUpperRight=(0,y.UJ)(D,B),F._texBottomLeft=(0,y.UJ)(R,U),F._texBottomRight=(0,y.UJ)(D,U)),u*=S,l*=S,u*=W,l*=W;var V=Math.round(64*S);F._bitestAndDistRatio=(0,y.UJ)(C,V),F._computedWidth=u,F._computedHeight=l;var G=(0,c.c)(),O=(0,h.c)();return F._applyTransformation(O,G),F}return(0,a.Z)(r,null,[{key:"fromCIMMarker",value:function(e,t,n){var a=t&&t.width||1,s=t&&t.height||1,o=e.size,h=a/s*e.scaleX,c=e.scaleSymbolsProportionally&&e.frameHeight?o/e.frameHeight:1,_=(0,v.t2)(e.color),d=(0,v.t2)(e.outlineColor),y=(0,l.F2)(o),p=y*h,x=(0,l.F2)(e.offsetX||0),g=(0,l.F2)(e.offsetY||0),M=(0,l.F2)(e.outlineWidth||0)*c,k=e.alignment||f.v2.SCREEN,w=(0,l.F2)(e.referenceSize),Z=(0,m._f)(e.scaleInfo,n),b=(0,i.Z)(Z,2),L=b[0],S=b[1];t.sdf||0!==_||(_=-1);var W=e.rotation||0;e.rotateClockwise||(W=-W);var P=0,I=0,T=e.anchorPoint;T&&(e.isAbsoluteAnchorPoint?o&&(P=T.x/(o*h),I=T.y/o):(P=T.x,I=T.y));var z=new r(e.materialKey,x,g,W,_,p,y,w,d,M,e.colorLocked,e.scaleSymbolsProportionally,!1,k,t,P,I,e.sizeRatio,(0,u.Pt)(e.scaleFactor,1),e.markerPlacement,e.effects,L,S);return z._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/p:1,z._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/y:1,z}},{key:"fromPictureMarker",value:function(e,t){var i=Math.round((0,l.F2)(e.width)),n=Math.round((0,l.F2)(e.height)),a=_.ru,s=Math.round((0,l.F2)(e.xoffset||0)),o=Math.round((0,l.F2)(e.yoffset||0)),u=new r(e.materialKey,s,o,e.angle,a,i,n,n,0,0,!1,!1,!1,f.v2.SCREEN,t,0,0,1,1,null,null,m.Xe,m.eW);return u._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,u._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,u}},{key:"fromSimpleMarker",value:function(e,t){var i=(0,v.aH)(e.color),n=Math.round((0,l.F2)(e.size)),a=n,s=Math.round((0,l.F2)(e.xoffset||0)),o=Math.round((0,l.F2)(e.yoffset||0)),u=e.style,h=e.outline,c=0|(h&&h.color&&(0,v.aH)(h.color)),_=0|(h&&h.width&&Math.round((0,l.F2)(h.width))),d=new r(e.materialKey,s,o,e.angle,i,n,a,a,c,_,!1,!1,"esriSMSCross"===u||"esriSMSX"===u,f.v2.SCREEN,t,0,0,126/64,1,null,null,m.Xe,m.eW);return d.boundsType="esriSMSCircle"===u?"circle":"square",d._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,d._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,d}},{key:"fromLineSymbolMarker",value:function(e,t){var i,n=(0,v.aH)(e.color),a=Math.round((0,l.F2)(6*e.lineWidth)),s=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":i=f.Tx.Both;break;case"begin":i=f.Tx.JustBegin;break;case"end":i=f.Tx.JustEnd;break;default:i=f.Tx.None}var u={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:i,offsetAlongLine:0},h=new r(e.materialKey,0,0,0,n,a,s,s/6,n,o?Math.round((0,l.F2)(e.lineWidth)):0,!1,!1,o,f.v2.MAP,t,0,0,126/64,1,u,null,m.Xe,m.eW);return h.boundsType="circle"===e.style?"circle":"square",h}}]),r}((0,x.Z)(g.Z))},52993:function(e,t,r){r.d(t,{Z:function(){return o}});var i=r(15671),n=r(43144),a=r(92026),s=r(95954),o=function(){function e(){(0,i.Z)(this,e)}return(0,n.Z)(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r,i){var n;if((0,a.Wi)(this._effects)||0===(null===(n=this._effects)||void 0===n?void 0:n.length))return this._write(e,t,i);for(var o=s.j.executeEffects(this._effects,t.readLegacyGeometryForDisplay(),i.geometryEngine),u=s.j.next(o);u;)this._write(e,t,i,u),u=s.j.next(o)}},{key:"_write",value:function(e,t,r,i){}}]),e}()},61909:function(e,t,r){r.d(t,{Wr:function(){return et},Sl:function(){return $e}});var i=r(74165),n=r(15861),a=r(37762),s=r(15671),o=r(43144),u=r(1413),l=r(10064),h=r(32718),c=r(66978),f=r(76115),v=r(80613),_=r(54815),d=r(29439),y=r(82963),p=r(60136),m=r(29388),x=r(92026),g=r(17842),M=r(65800),k=r(94109),w=r(13200),Z=r(73271),b=r(42093),L=r(83406),S=r(46640),W=(r(79347),r(48035)),P=r(80457),I=r(60652),T=r(91623);function z(e,t,r,i,n,a,s){ie=0;var o,u,l,h,c,f=(i-r)*a,v=n&&n.length,_=v?(n[0]-r)*a:f,d=F(t,r,i,0,_,a,!0);if(d&&d.next!==d.prev){if(v&&(d=V(t,r,i,n,d,a)),f>80*a){o=l=t[0+r*a],u=h=t[1+r*a];for(var y=a;y<_;y+=a){var p=t[y+r*a],m=t[y+1+r*a];o=Math.min(o,p),u=Math.min(u,m),l=Math.max(l,p),h=Math.max(h,m)}c=0!==(c=Math.max(l-o,h-u))?1/c:0}A(d,e,a,o,u,c,s,0)}}function F(e,t,r,i,n,a,s){var o;if(s===function(e,t,r,i,n,a){for(var s=0,o=i,u=n-a;o<n;o+=a)s+=(e[u+t*a]-e[o+t*a])*(e[o+1+t*a]+e[u+1+t*a]),u=o;return s}(e,t,0,i,n,a)>0)for(var u=i;u<n;u+=a)o=B(u+t*a,e[u+t*a],e[u+1+t*a],o);else for(var l=n-a;l>=i;l-=a)o=B(l+t*a,e[l+t*a],e[l+1+t*a],o);return o&&Y(o,o.next)&&(D(o),o=o.next),o}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,i=e;do{if(r=!1,i.steiner||!Y(i,i.next)&&0!==J(i.prev,i,i.next))i=i.next;else{if(D(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function A(e,t,r,i,n,a,s,o){if(e){!o&&a&&(e=O(e,i,n,a));for(var u=e;e.prev!==e.next;){var l=e.prev,h=e.next;if(a?R(e,i,n,a):E(e))t.push(l.index/r+s),t.push(e.index/r+s),t.push(h.index/r+s),D(e),e=h.next,u=h.next;else if((e=h)===u){o?1===o?A(e=j(e,t,r,s),t,r,i,n,a,s,2):2===o&&Q(e,t,r,i,n,a,s):A(C(e),t,r,i,n,a,s,1);break}}}}function E(e){var t=e.prev,r=e,i=e.next;if(J(t,r,i)>=0)return!1;for(var n=e.next.next,a=n,s=0;n!==e.prev&&(0===s||n!==a);){if(s++,X(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&J(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function R(e,t,r,i){var n=e.prev,a=e,s=e.next;if(J(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,u=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,h=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,c=H(o,u,t,r,i),f=H(l,h,t,r,i),v=e.prevZ,_=e.nextZ;v&&v.z>=c&&_&&_.z<=f;){if(v!==e.prev&&v!==e.next&&X(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&J(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_!==e.prev&&_!==e.next&&X(n.x,n.y,a.x,a.y,s.x,s.y,_.x,_.y)&&J(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=c;){if(v!==e.prev&&v!==e.next&&X(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&J(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=f;){if(_!==e.prev&&_!==e.next&&X(n.x,n.y,a.x,a.y,s.x,s.y,_.x,_.y)&&J(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function B(e,t,r,i){var n=te.create(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function D(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function U(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function V(e,t,r,i,n,a){for(var s=new Array,o=0,u=i.length;o<u;o++){var l=F(e,t,0,i[o]*a,o<u-1?i[o+1]*a:r*a,a,!1);l===l.next&&(l.steiner=!0),s.push(U(l))}s.sort(q);for(var h=0,c=s;h<c.length;h++){n=G(c[h],n)}return n}function G(e,t){var r=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r.prev;var u,l=r,h=r.x,c=r.y,f=1/0;for(i=r.next;i!==l;)n>=i.x&&i.x>=h&&n!==i.x&&X(a<c?n:s,a,h,c,a<c?s:n,a,i.x,i.y)&&(((u=Math.abs(a-i.y)/(n-i.x))<f||u===f&&i.x>r.x)&&N(i,e)&&(r=i,f=u)),i=i.next;return r}(e,t);if(!r)return t;var i=ee(r,e);return C(i,i.next),C(r,r.next)}function O(e,t,r,i){for(var n;n!==e;n=n.next){if(null===(n=n||e).z&&(n.z=H(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,O(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var i=void 0,n=e;e=null,t=null;for(var a=0;n;){a++,i=n;for(var s=0;s<r&&i;s++)i=i.nextZ;for(var o=r;s>0||o>0&&i;){var u=void 0;0===s?(u=i,i=i.nextZ,o--):0!==o&&i?n.z<=i.z?(u=n,n=n.nextZ,s--):(u=i,i=i.nextZ,o--):(u=n,n=n.nextZ,s--),t?t.nextZ=u:e=u,u.prevZ=t,t=u}n=i}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function J(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function K(e,t,r,i){return!!(Y(e,t)&&Y(r,i)||Y(e,i)&&Y(r,t))||J(e,t,r)>0!=J(e,t,i)>0&&J(r,i,e)>0!=J(r,i,t)>0}function X(e,t,r,i,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0}function N(e,t){return J(e.prev,e,e.next)<0?J(e,t,e.next)>=0&&J(e,e.prev,t)>=0:J(e,t,e.prev)<0||J(e,e.next,t)<0}function H(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Y(e,t){return e.x===t.x&&e.y===t.y}function q(e,t){return e.x-t.x}function j(e,t,r,i){var n=e;do{var a=n.prev,s=n.next.next;!Y(a,s)&&K(a,n,n.next,s)&&N(a,s)&&N(s,a)&&(t.push(a.index/r+i),t.push(n.index/r+i),t.push(s.index/r+i),D(n),D(n.next),n=e=s),n=n.next}while(n!==e);return n}function Q(e,t,r,i,n,a,s){var o=e;do{for(var u=o.next.next;u!==o.prev;){if(o.index!==u.index&&$(o,u)){var l=ee(o,u);return o=C(o,o.next),l=C(l,l.next),A(o,t,r,i,n,a,s,0),void A(l,t,r,i,n,a,s,0)}u=u.next}o=o.next}while(o!==e)}function $(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&K(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&N(e,t)&&N(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function ee(e,t){var r=te.create(e.index,e.x,e.y),i=te.create(t.index,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}for(var te=function(){function e(){(0,s.Z)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return(0,o.Z)(e,null,[{key:"create",value:function(t,r,i){var n=ie<re.length?re[ie++]:new e;return n.index=t,n.x=r,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}]),e}(),re=new Array,ie=0,ne=0;ne<8096;ne++)re.push(new te);var ae=new T.b(0,0,0,1,0),se=new T.b(0,0,0,1,0);function oe(e,t,r){for(var i=0,n=1;n<r;n++){var a=e[2*(t+n-1)],s=e[2*(t+n-1)+1];i+=(e[2*(t+n)]-a)*(e[2*(t+n)+1]+s)}return i}function ue(e,t,r,i,n){for(var a=0,s=r;s<i;s+=3){var o=2*(e[s]-n),u=2*(e[s+1]-n),l=2*(e[s+2]-n);a+=Math.abs((t[o]-t[l])*(t[u+1]-t[o+1])-(t[o]-t[u])*(t[l+1]-t[o+1]))}return a}ae.setExtent(k.I_),se.setExtent(k.I_);var le=r(48202),he=r(82010),ce=16,fe=function(e){return function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).tessellationProperties={},e._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},e.geometryType=v.LW.LINE,e}return(0,o.Z)(r,[{key:"writeGeometry",value:function(e,t,r,i){this._writeGeometry(e,t,r,i)}},{key:"_initializeTessellator",value:function(e){var t=_.a.load(this._materialKey),r=_.dk.load(this._materialKey),i=this._tessellationOptions,n=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,a=this.tessellationProperties._halfWidth<k.tQ&&!e&&!n;this.tessellationProperties.minMaxZoom=this._minMaxZoom,i.wrapDistance=65535,i.textured=this._isDashed||this._hasPattern,i.offset=this.tessellationProperties.offset,i.halfWidth=this.tessellationProperties._halfWidth;var s=a?0:1,o=(0,_.CA)(r)?_e:ve;this._lineTessellator=new he.z(o(this.tessellationProperties,s,s),de(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i){var n=null!==r&&void 0!==r?r:t.readLegacyGeometryForDisplay(),a=this._getLines(n,i);(0,x.Wi)(a)||this._writeVertices(e,t,a)}},{key:"_getLines",value:function(e,t){if((0,x.Wi)(e))return null;var r=e.paths||e.rings;return(0,x.Wi)(r)?null:function(e,t){se.setPixelMargin(t);for(var r=se,i=-t,n=k.I_+t,s=[],o=!1,u=0;u<e.length;){var l=[],h=e[u];if(!h)return null;r.reset(I.V.LineString);var c=(0,d.Z)(h[0],2),f=c[0],v=c[1];if(o)r.moveTo(f,v);else{if(f<i||f>n||v<i||v>n){o=!0;continue}l.push({x:f,y:v})}for(var _=!1,y=h.length,p=1;p<y;++p)if(f+=h[p][0],v+=h[p][1],o)r.lineTo(f,v);else{if(f<i||f>n||v<i||v>n){_=!0;break}l.push({x:f,y:v})}if(_)o=!0;else{if(o){var m=r.resultWithStarts();if(m){var x,g=(0,a.Z)(m);try{for(g.s();!(x=g.n()).done;){var M=x.value;s.push(M)}}catch(w){g.e(w)}finally{g.f()}}}else s.push({line:l,start:0});u++,o=!1}}return s=s.filter((function(e){return e.line.length>1})),0===s.length?null:s}(r,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var i=t.getDisplayId(),n=e.vertexCount(),s=this.tessellationProperties,o=this._tessellationOptions;s.out=e,s.id=i,s.indexCount=0,s.vertexCount=0,s.offset=n,o.capType=this._capType,o.joinType=this._joinType;var u=_.dk.load(this._materialKey);this.tessellationProperties.key=(0,_.CA)(u)?u:_.a.load(this._materialKey);var l,h=(0,a.Z)(r);try{for(h.s();!(l=h.n()).done;){var c=l.value,f=c.line,v=c.start;o.initialDistance=v%65535,this._lineTessellator.tessellate(f,o)}}catch(d){h.e(d)}finally{h.f()}}}]),r}(e)},ve=function(e,t,r){return function(i,n,a,s,o,u,l,h,c,f,v){var _=(0,Z.UJ)(v,Math.ceil(ce*e._halfWidth)),d=(0,Z.Jz)(Math.round(ce*l),Math.round(ce*h),Math.round(ce*c),Math.round(ce*f)),y=(0,Z.Jz)(ce*o,ce*u,0,e._bitset),p=e.out;return p.vertexBounds(i,n,t,r),p.vertexWrite((0,Z.UJ)(8*i,8*n)),p.vertexWrite(e.id),p.vertexWrite(e._fillColor),p.vertexWrite(d),p.vertexWrite(_),p.vertexWrite(e._tl),p.vertexWrite(e._br),p.vertexWrite(y),p.vertexWrite((0,Z.UJ)(Math.ceil(ce*e._halfReferenceWidth),0)),p.vertexWrite(e.minMaxZoom),p.vertexEnd(),e.offset+e.vertexCount++}},_e=function(e,t,r){return function(i,n,a,s,o,u,l,h,c,f,v){var d=(0,Z.UJ)(ce*e._halfWidth,ce*e._halfReferenceWidth),y=(0,Z.Jz)(ce*l+128,ce*h+128,ce*c+128,ce*f+128),p=e.out,m=e._bitset<<24|e.id;p.vertexBounds(i,n,t,r),p.vertexWrite((0,Z.UJ)(8*i,8*n)),p.vertexWrite(m),p.vertexWrite(e._fillColor);var x=(0,_.Xp)(e.key);return x||(p.vertexWrite(0),p.vertexWrite(0)),p.vertexWrite(0),p.vertexWrite(d),p.vertexWrite(y),x||p.vertexWrite(e.minMaxZoom),p.vertexEnd(),e.offset+e.vertexCount++}},de=function(e){return function(t,r,i){var n=e.out;n.indexWrite(t),n.indexWrite(r),n.indexWrite(i),e.indexCount+=3}},ye=r(52993),pe=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n,a,o,u,l,h,c,f,v,d,y,p,m,x,g,M,w,L){var S;(0,s.Z)(this,r),S=t.call(this);var W=_.a.load(e);i&&(W.sdf=i.sdf,W.pattern=!0,W.textureBinding=i.textureBinding),S._capType=a,S._joinType=o,S._miterLimitCosine=(0,b.NW)(u),S.tessellationProperties._fillColor=l,S.tessellationProperties._tl=h,S.tessellationProperties._br=c,S._hasPattern=f,S._isDashed=v,S._zOrder=g,S._effects=M,S._minMaxZoom=(0,Z.UJ)(Math.round(w*k.MI),Math.round(L*k.MI)),S._materialKey=W.data;var P=(y?k.Uh:0)|(p?k.SD:0)|(d?k._6:0)|(m?k.Iv:0);return S.tessellationProperties._bitset=P,S.tessellationProperties._halfWidth=.5*n,S.tessellationProperties._halfReferenceWidth=.5*x,S.tessellationProperties.offset=0,S._initializeTessellator(!1),S}return(0,o.Z)(r,null,[{key:"fromCIMLine",value:function(e,t,i){var n=e.color,a=e.scaleFactor||1,s=!!e.dashTemplate,o=e.cap;s&&o===le.RL.ROUND&&(o=le.RL.SQUARE);var u=e.join,l=(0,g.F2)(e.width)*a,h=(0,g.F2)(e.referenceWidth),c=(0,g.F2)(e.miterLimit),f=n&&(0,M.t2)(n)||0,v=(0,b._f)(e.scaleInfo,i),_=(0,d.Z)(v,2),y=_[0],p=_[1];if(!t)return new r(e.materialKey,t,l,o,u,c,f,0,0,!1,s,e.scaleDash,e.colorLocked,!1,e.sampleAlphaOnly,h,e.zOrder,e.effects,y,p);var m=t.rect,x=t.width,w=t.height,L=m.x+k.fL,S=m.y+k.fL,W=L+x,P=S+w,I=(0,Z.UJ)(L,S),T=(0,Z.UJ)(W,P);return new r(e.materialKey,t,l,o,u,c,f,I,T,!0,s,e.scaleDash,e.colorLocked,!1,e.sampleAlphaOnly,h,e.zOrder,e.effects,y,p)}},{key:"fromFillOutline",value:function(e){var t,i=_.dk.load(e.materialKey);return(0,_.CA)(i)&&e.outline&&"esriSLSSolid"===(null===(t=e.outline)||void 0===t?void 0:t.style)?r.fromSimpleLine((0,u.Z)({hash:"",materialKey:e.materialKey},e.outline),null,!0):null}},{key:"fromSimpleLine",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,s=(0,S.ws)(e.cap||"round"),o=(0,S.xV)(e.join||"round"),u=n&&"esriSLSNull"!==e.style&&(0,M.aH)(n)||0;"esriSLSNull"===e.style&&(u=0);var l=(0,g.F2)(e.width),h=e.miterLimit;if(!t)return new r(e.materialKey,t,l,s,o,h,u,0,0,!1,a,!0,!1,i,!1,l,0,null,b.Xe,b.eW);var c=t.rect,f=t.width,v=t.height,_=c.x+k.fL,d=c.y+k.fL,y=_+f,p=d+v,m=(0,Z.UJ)(_,d),x=(0,Z.UJ)(y,p);return new r(e.materialKey,t,l,s,o,h,u,m,x,!0,a,!0,!1,i,!1,l,0,null,b.Xe,b.eW)}},{key:"fromPictureLineSymbol",value:function(e,t,r,i){return h.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!"),null}}]),r}(fe(ye.Z)),me=function(e){return function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).forceLibtess=!1,e._bitset=0,e._lineTemplate=null,e.geometryType=v.LW.FILL,e}return(0,o.Z)(r,[{key:"_maybeAddLineTemplate",value:function(e){this._lineTemplate=pe.fromFillOutline(e)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType,a=_.dk.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,a,i,n),(0,_.CA)(a)&&(0,x.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,n){var a=this._getGeometry(t,i,n);if(!(0,x.Wi)(a)){var s=[];if(a.maxLength>100||this.forceLibtess||!function(e,t){var r=t.coords,i=t.lengths,n=e;if(t.hasIndeterminateRingOrder)return!1;for(var a=0,s=0;s<i.length;){for(var o=s,u=i[s],l=oe(r,a,u),h=[];++o<i.length;){var c=i[o],f=oe(r,a+u,c);if(!(f>0))break;l+=f,h.push(a+u),u+=c}var v=n.length;z(n,r,a,a+u,h,2,0);var _=ue(n,r,v,n.length,0),d=Math.abs(l);if(Math.abs((_-d)/Math.max(1e-7,d))>1e-5)return n.length=0,!1;s=o,a+=u}return!0}(s,a)){var o=function(e){var t=e.coords,r=e.lengths;return(0,W.b)(t,r).buffer}(a);this._writeVertices(e,t,o,[o.length/2],r)}else s.length&&this._writeVertices(e,t,a.coords,a.lengths,r,s)}}},{key:"_writeVertex",value:function(e,t,r,i,n,a){var s=(0,Z.UJ)(1*i,1*n);if(e.vertexBounds(i,n,0,0),e.vertexWrite(s),e.vertexWrite(t),r.symbologyType===v.mD.DOT_DENSITY)e.vertexWriteF32(1/Math.abs(a.readGeometryArea()));else{e.vertexWrite(this.fillColor);var o=(0,_.Xp)(r);o||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux21),e.vertexWrite(this.aux22),e.vertexWrite(this.aux3),o||e.vertexWrite(this._minMaxZoom)}}},{key:"_writeVertices",value:function(e,t,r,i,n,s){var o=t.getDisplayId(),u=this._bitset<<24|o,l=i.reduce((function(e,t){return e+t})),h=(0,S.$_)(n.geometryType,n.symbologyType).geometry/4,c=e.vertexCount();e.vertexEnsureSize(h*l);var f=0;if(s){var v,_=(0,a.Z)(s);try{for(_.s();!(v=_.n()).done;){var d=v.value,y=r[2*d],p=r[2*d+1];this._writeVertex(e,u,n,y,p,t),f++}}catch(k){_.e(k)}finally{_.f()}}else for(var m=0;m<r.length;m+=2){var x=Math.round(r[m]),g=Math.round(r[m+1]);this._writeVertex(e,u,n,x,g,t),f++}e.indexEnsureSize(f);for(var M=0;M<f;M++)e.indexWrite(M+c)}},{key:"_getGeometry",value:function(e,t,r){var i=t?(0,L.oB)((0,L.GH)(t),2):e.readGeometryForDisplay();return i?function(e,t){if((0,x.Wi)(e))return null;if(!function(e,t,r){for(var i=0,n=0;n<e.lengths.length;n++){for(var a=e.lengths[n],s=0;s<a;s++){var o=e.coords[2*(s+i)],u=e.coords[2*(s+i)+1];if(o<t||o>r||u<t||u>r)return!0}i+=a}return!1}(e,-128,k.I_+128))return e;ae.setPixelMargin(t),ae.reset(I.V.Polygon);for(var r=0,i=0;i<e.lengths.length;i++){var n=e.lengths[i],s=e.coords[2*(0+r)],o=e.coords[2*(0+r)+1];ae.moveTo(s,o);for(var u=1;u<n;u++)s=e.coords[2*(u+r)],o=e.coords[2*(u+r)+1],ae.lineTo(s,o);ae.close(),r+=n}var l=ae.result(!1);if(!l)return null;var h,c=[],f=[],v=(0,a.Z)(l);try{for(v.s();!(h=v.n()).done;){var _,d=h.value,y=0,p=(0,a.Z)(d);try{for(p.s();!(_=p.n()).done;){var m=_.value;f.push(m.x),f.push(m.y),y++}}catch(g){p.e(g)}finally{p.f()}c.push(y)}}catch(g){v.e(g)}finally{v.f()}return new P.Z(c,f)}(i,r?256:8):null}}]),r}(e)},xe=r(98991),ge=r(31027),Me=h.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),ke=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e){var i;return(0,s.Z)(this,r),(i=t.call(this))._ongoingMaterialRequestMap=new Map,i._materialCache=new Map,i._dynamicPropertyMap=new Map,i._cimLayer=e,i}return(0,o.Z)(r,[{key:"analyze",value:function(e,t,r,i,n){var a=this;if(n&&0===n.length)return null;var s=n&&n.length>0,o=t.readLegacyFeature(),u=t.getObjectId(),l=this._materialCache,h=this._cimLayer.materialHash;if(!h)return Me.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var c="function"==typeof h?h(o,r,i,u):h;if(l.has(c)){var f=l.get(c);return Promise.resolve(f)}var v=this._ongoingMaterialRequestMap.get(c);if(v)return v;var _=this._cimLayer,d=(0,xe.S)(_.cim,this._cimLayer.materialOverrides);d.mosaicHash=c;var y=_.type,p=_.url,m={cim:d,type:y,mosaicHash:c,url:p,size:null,dashTemplate:null,text:null,fontName:null,objectId:u,animatedSymbolProperties:null};switch(y){case"marker":m.size=(0,ge.hf)(_.size,o,r,i),m.animatedSymbolProperties=(0,ge.hf)(_.animatedSymbolProperties,o,r,i);break;case"line":m.dashTemplate=_.dashTemplate;break;case"text":m.text=(0,ge.hf)(_.text,o,r,i),m.fontName=(0,ge.hf)(_.fontName,o,r,i)}var x=e.getMosaicItem(m,n).then((function(e){return s||(a._ongoingMaterialRequestMap.delete(c),l.set(c,e)),e})).catch((function(e){return a._ongoingMaterialRequestMap.delete(c),Me.error(".analyze()",e.message),null}));return s||this._ongoingMaterialRequestMap.set(c,x),x}}]),r}(ye.Z),we=r(55940),Ze=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n){var a,o;if((0,s.Z)(this,r),(o=t.call(this,e))._minMaxZoom=(0,Z.UJ)(Math.round(i*k.MI),Math.round(n*k.MI)),(0,b.mf)(e.color)){o._dynamicPropertyMap.set("fillColor",(function(t,r,i){var n=e.color(t,r,i);return n&&(0,M.t2)(n)||0}))}else{var u=e.color;o.fillColor=u&&(0,M.t2)(u)||0}var l="CIMMarkerPlacementInsidePolygon"===(null===(a=e.cim.placement)||void 0===a?void 0:a.type)&&e.cim.placement.shiftOddRows?2:1,h=e.height;if((0,b.mf)(h)){o._dynamicPropertyMap.set("_height",(function(e,t,r){return h(e,t,r)*l}))}else o._height=(h||0)*l;var c=e.offsetX;if((0,b.mf)(c)){o._dynamicPropertyMap.set("_offsetX",(function(e,t,r){return(0,g.F2)(c(e,t,r))}))}else o._offsetX=(0,g.F2)(c||0);var f=e.offsetY;if((0,b.mf)(f)){o._dynamicPropertyMap.set("_offsetY",(function(e,t,r){return(0,g.F2)(-f(e,t,r))}))}else o._offsetY=(0,g.F2)(-f||0);var v=e.scaleX;(0,b.mf)(v)?o._dynamicPropertyMap.set("_scaleX",v):o._scaleX=v||1;var _=e.angle;if((0,b.mf)(_)){o._dynamicPropertyMap.set("_angle",(function(e,t,r){return(0,w.s5)(_(e,t,r))}))}else o._angle=(0,w.s5)(_)||0;if((0,x.pC)(e.effects)){var d=e.effects;(0,b.mf)(d)?o._dynamicPropertyMap.set("_effects",d):o._effects=d}return o._cimFillLayer=e,o._bitset=(e.colorLocked?k.Uh:0)|(e.applyRandomOffset?k.jk:0)|(e.sampleAlphaOnly?k.Iv:0),o._fillMaterialKey=e.materialKey,(0,y.Z)(o)}return(0,o.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var a=_.dk.load(this._fillMaterialKey),s=this._materialCache,o=(0,this._cimFillLayer.materialHash)(n,t,r),u=s.get(o),l=null;if(u&&(0,we.ok)(u.spriteMosaicItem)&&(l=u.spriteMosaicItem),l){var h=l,c=h.rect,f=h.width,v=h.height,d=c.x+k.fL,y=c.y+k.fL,p=d+f,m=y+v,x=Math.round((0,g.F2)(this._height));x<=0&&(x=m-y);var M=Math.round((0,g.F2)(this._height/v*f||0));M<=0&&(M=p-d);var w=this._scaleX;this.tl=(0,Z.UJ)(d,y),this.br=(0,Z.UJ)(p,m),this.aux21=(0,Z.UJ)(M,x),this.aux22=(0,Z.UJ)(this._offsetX,this._offsetY),this.aux3=(0,Z.Jz)(128*w,128,this._angle,0),a.sdf=l.sdf,a.pattern=!0,a.textureBinding=l.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var i=(0,b._f)(e.scaleInfo,t),n=(0,d.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(me(ke)),be=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n){var a;(0,s.Z)(this,r),(a=t.call(this,e))._minMaxZoom=(0,Z.UJ)(Math.round(i*k.MI),Math.round(n*k.MI)),a._cimLineLayer=e;var o=0;(0,b.mf)(e.width)||(o=.5*(0,g.F2)(e.width));a._dynamicPropertyMap.set("_halfWidth",(function(t,r,i){return(0,b.mf)(e.width)?.5*(0,g.F2)(e.width(t,r,i)):o})),(0,b.mf)(e.cap)?a._dynamicPropertyMap.set("_capType",e.cap):a._capType=e.cap,(0,b.mf)(e.join)?a._dynamicPropertyMap.set("_joinType",e.join):a._joinType=e.join;var u=e.color;if((0,b.mf)(u)){a._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,M.t2)(u(e,t,r))}))}else a._fillColor=u&&(0,M.t2)(u)||0;var l=e.miterLimit;if((0,b.mf)(l)){a._dynamicPropertyMap.set("_miterLimitCosine",(function(e,t,r){return(0,b.NW)(l(e,t,r))}))}else a._miterLimitCosine=(0,b.NW)(l);if((0,x.pC)(e.effects)){var h=e.effects;(0,b.mf)(h)?a._dynamicPropertyMap.set("_effects",h):a._effects=h}a._scaleFactor=e.scaleFactor||1,a._isDashed=null!=e.dashTemplate;var c=e.colorLocked?k.Uh:0,f=e.scaleDash?k._6:0,v=e.sampleAlphaOnly?k.Iv:0;return a.tessellationProperties._bitset=c|f|v,a._materialKey=e.materialKey,a._initializeTessellator(!0),a}return(0,o.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(n,t,r),o=a.get(s),u=null;if(o&&(0,we.ok)(o.spriteMosaicItem)&&(u=o.spriteMosaicItem),u){this._hasPattern=!0;var l=u,h=l.rect,c=l.width,f=l.height,v=h.x+k.fL,d=h.y+k.fL,y=v+c,p=d+f;this.tessellationProperties._tl=(0,Z.UJ)(v,d),this.tessellationProperties._br=(0,Z.UJ)(y,p)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var m=_.a.load(this._materialKey);u&&(m.sdf=u.sdf,m.pattern=!0,m.textureBinding=u.textureBinding),this._materialKey=m.data}}],[{key:"fromCIMLine",value:function(e,t){var i=(0,b._f)(e.scaleInfo,t),n=(0,d.Z)(i,2);return new r(e,n[0],n[1])}}]),r}(fe(ke)),Le=r(11245),Se=r(15245),We=r(59697),Pe=(0,Se.c)(),Ie=(0,Le.c)(),Te=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n){var a;(0,s.Z)(this,r),(a=t.call(this,e))._cimMarkerLayer=e,a._minMaxZoom=(0,Z.UJ)(Math.round(i*k.MI),Math.round(n*k.MI));var o=e.color;if((0,b.mf)(o)){a._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,M.t2)(o(e,t,r))}))}else a._fillColor=(0,M.t2)(o);var u=e.outlineColor;if((0,b.mf)(u)){a._dynamicPropertyMap.set("_outlineColor",(function(e,t,r){return(0,M.t2)(u(e,t,r))}))}else a._outlineColor=(0,M.t2)(u);var l=e.size;if((0,b.mf)(l)){a._dynamicPropertyMap.set("_size",(function(e,t,r){return(0,g.F2)(l(e,t,r))}))}else a._size=(0,g.F2)(l)||0;var h=e.scaleX;(0,b.mf)(h)?a._dynamicPropertyMap.set("_scaleX",h):a._scaleX=h;var c=e.offsetX;if((0,b.mf)(c)){a._dynamicPropertyMap.set("xOffset",(function(e,t,r){return(0,g.F2)(c(e,t,r))}))}else a.xOffset=(0,g.F2)(c)||0;var f=e.offsetY;if((0,b.mf)(f)){a._dynamicPropertyMap.set("yOffset",(function(e,t,r){return(0,g.F2)(f(e,t,r))}))}else a.yOffset=(0,g.F2)(f)||0;var v=e.outlineWidth;if((0,b.mf)(v)){a._dynamicPropertyMap.set("_outlineWidth",(function(e,t,r){return(0,g.F2)(v(e,t,r))}))}else a._outlineWidth=(0,g.F2)(v)||0;var _=e.rotation;if((0,b.mf)(_)?a._dynamicPropertyMap.set("_angle",_):a._angle=_||0,(0,x.pC)(e.effects)){var d=e.effects;(0,b.mf)(d)?a._dynamicPropertyMap.set("_effects",d):a._effects=d}if((0,x.pC)(e.markerPlacement)){var y=e.markerPlacement;(0,b.mf)(y)?a._dynamicPropertyMap.set("_markerPlacement",y):a._markerPlacement=y}return a._scaleFactor=(0,x.Pt)(e.scaleFactor,1),a._bitSet=(e.alignment===le.v2.MAP?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,a._materialKey=e.materialKey,a}return(0,o.Z)(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature(),a=e.getObjectId();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var s=this._cimMarkerLayer.materialHash,o="function"==typeof s?s(n,t,r,a):s,u=this._materialCache.get(o);if(u&&(0,we.ok)(u.spriteMosaicItem)&&u.spriteMosaicItem){var c=u.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,v=c.width/c.height*this._scaleX,d=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,y=this._size,p=y*v,m=this.xOffset,x=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var M=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,g.F2)(this._cimMarkerLayer.frameHeight):1,w=this._outlineWidth*M,b=(0,g.F2)(this._cimMarkerLayer.referenceSize),L=0,S=0,W=this._cimMarkerLayer.anchorPoint;W&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(L=(0,g.F2)(W.x)/(this._size*v),S=(0,g.F2)(W.y)/this._size):(L=W.x,S=W.y)),this._anchorX=L,this._anchorY=S,this._sizeOutlineWidth=(0,Z.Jz)(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*w),255)),Math.round(Math.min(Math.sqrt(128*b),255))),this.angle=d;var P=Math.round(64*f);this._bitestAndDistRatio=(0,Z.UJ)(this._bitSet,P);var I=c.rect.x+k.fL,T=c.rect.y+k.fL,z=I+c.width,F=T+c.height;this._texUpperLeft=(0,Z.UJ)(I,T),this._texUpperRight=(0,Z.UJ)(z,T),this._texBottomLeft=(0,Z.UJ)(I,F),this._texBottomRight=(0,Z.UJ)(z,F);var C=_.mE.load(this._materialKey);C.sdf=c.sdf,C.pattern=!0,C.textureBinding=c.textureBinding,this._materialKey=C.data,p*=f,y*=f,p*=this._scaleFactor,y*=this._scaleFactor,p*=c.rect.width/c.width,y*=c.rect.height/c.height,this._computedWidth=p,this._computedHeight=y,this._applyTransformation(Ie,Pe),this.xOffset=m,this.yOffset=x}else h.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new l.Z("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var i=(0,b._f)(e.scaleInfo,t),n=(0,d.Z)(i,2);return new r(e,n[0],n[1])}}]),r}((0,We.Z)(ke)),ze=r(11752),Fe=r(61120),Ce=r(38999),Ae=r(5748),Ee=r(27301);function Re(e,t,r,i){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,i):""}var Be=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n){var a;(0,s.Z)(this,r),(a=t.call(this,e))._horizontalAlignment="center",a._verticalAlignment="middle",a._textToGlyphs=new Map,a._minMaxZoom=(0,Z.UJ)(Math.round(i*k.MI),Math.round(n*k.MI));var o=e.scaleFactor||1;a._cimTextLayer=e;var u=e.color;if((0,b.mf)(u)){a._dynamicPropertyMap.set("_color",(function(e,t,r){return(0,M.t2)(u(e,t,r))}))}else a._color=(0,M.t2)(u);var l,h=e.outlineColor;if((0,b.mf)(h)){a._dynamicPropertyMap.set("_haloColor",(function(e,t,r){return(0,M.t2)(h(e,t,r))}))}else a._haloColor=(0,M.t2)(h);(0,b.mf)(e.size)||(l=Math.min(Math.round((0,g.F2)(e.size*e.sizeRatio)),127));var c;if(a._dynamicPropertyMap.set("_size",(function(t,r,i){return(0,b.mf)(e.size)?Math.min(Math.round((0,g.F2)(e.size(t,r,i)*e.sizeRatio)),127):l})),(0,b.mf)(e.outlineSize)){a._dynamicPropertyMap.set("_haloSize",(function(t,r,i){return Math.min(Math.floor(5*(0,g.F2)(e.outlineSize(t,r,i)*e.sizeRatio)),127)}))}else a._haloSize=Math.min(Math.floor(5*(0,g.F2)(e.outlineSize*e.sizeRatio)),127);(0,b.mf)(e.offsetX)||(c=Math.round((0,g.F2)(e.offsetX*e.sizeRatio)));var f;a._dynamicPropertyMap.set("_xOffset",(function(t,r,i){return(0,b.mf)(e.offsetX)?Math.round((0,g.F2)(e.offsetX(t,r,i)*e.sizeRatio)):c})),(0,b.mf)(e.offsetY)||(f=Math.round((0,g.F2)(e.offsetY*e.sizeRatio)));if(a._dynamicPropertyMap.set("_yOffset",(function(t,r,i){return(0,b.mf)(e.offsetY)?Math.round((0,g.F2)(e.offsetY(t,r,i)*e.sizeRatio)):f})),(0,b.mf)(e.angle)?a._dynamicPropertyMap.set("_angle",e.angle):a._angle=e.angle,(0,b.mf)(e.horizontalAlignment)?a._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):a._horizontalAlignment=e.horizontalAlignment,(0,b.mf)(e.verticalAlignment)?a._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):a._verticalAlignment=e.verticalAlignment,(0,x.pC)(e.effects)){var v=e.effects;(0,b.mf)(v)?a._dynamicPropertyMap.set("_effects",v):a._effects=v}if((0,x.pC)(e.markerPlacement)){var d=e.markerPlacement;(0,b.mf)(d)?a._dynamicPropertyMap.set("_markerPlacement",d):a._textPlacement=d}(0,b.mf)(e.text)?a._dynamicPropertyMap.set("_text",e.text):a._text=e.text,a._scaleFactor=o;var y=Math.min(Math.round((0,g.F2)(e.referenceSize*e.sizeRatio)),127);a._referenceSize=Math.round(Math.sqrt(256*y)),a._materialKey=e.materialKey;var p=_.qr.load(a._materialKey);return p.sdf=!0,a._bitset=(e.alignment===le.v2.MAP?1:0)|(e.colorLocked?1:0)<<1,a._materialKey=p.data,a._decoration="none",a._lineHeight=1,a._lineWidth=512,a._isCIM=!0,a}return(0,o.Z)(r,[{key:"analyze",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,n,a,s){var o,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.readLegacyFeature(),u=Re(this._cimTextLayer,o,a,s),e.next=4,(0,ze.Z)((0,Fe.Z)(r.prototype),"analyze",this).call(this,t,n,a,s,(0,Ee._)(u));case 4:return l=e.sent,e.abrupt("return",(l&&l.glyphMosaicItems&&this._textToGlyphs.set(u,l.glyphMosaicItems),l));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/k.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,Ce.kH)((0,x.Pt)(this._horizontalAlignment,"center")),this._yAlignD=(0,Ce.b7)((0,x.Pt)(this._verticalAlignment,"baseline"));var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var i=(0,b._f)(e.scaleInfo,t),n=(0,d.Z)(i,2);return new r(e,n[0],n[1])}}]),r}((0,Ae.Z)(ke)),De=128,Ue=function(e){(0,p.Z)(r,e);var t=(0,m.Z)(r);function r(e,i,n,a,o,u,l,h,c,f,v,d,y,p,m,x){var g;(0,s.Z)(this,r),(g=t.call(this))._effects=p;var M=_.dk.load(e);return i&&(M.sdf=i.sdf,M.pattern=!0,M.textureBinding=i.textureBinding),g.fillColor=n,g.tl=a,g.br=o,g.aux21=(0,Z.UJ)(u,l),g.aux22=(0,Z.UJ)(h,c),g.aux3=(0,Z.Jz)(f,v,d,0),g._bitset=y,g._minMaxZoom=(0,Z.UJ)(Math.round(m*k.MI),Math.round(x*k.MI)),g._materialKey=M.data,g}return(0,o.Z)(r,null,[{key:"fromCIMFill",value:function(e,t,i){var n=e.color,a=n&&(0,M.t2)(n)||0,s=e.materialKey,o=(0,b._f)(e.scaleInfo,i),u=(0,d.Z)(o,2),l=u[0],h=u[1],c=(e.colorLocked?k.Uh:0)|(e.applyRandomOffset?k.jk:0)|(e.sampleAlphaOnly?k.Iv:0);if(!t)return new r(s,null,a,0,0,0,0,0,0,0,0,0,c,e.effects,l,h);var f=t.rect,v=t.width,_=t.height,y=e.scaleX||1,p=f.x+k.fL,m=f.y+k.fL,x=p+v,L=m+_,S=(0,g.F2)(e.height),W=y*S,P=Math.round(S);P<=0&&(P=L-m);var I=Math.round(W);I<=0&&(I=x-p);var T=(0,g.F2)(e.offsetX||0),z=(0,g.F2)(-e.offsetY||0);return new r(s,t,a,(0,Z.UJ)(p,m),(0,Z.UJ)(x,L),I,P,T,z,De,De,(0,w.s5)(e.angle),c,e.effects,l,h)}},{key:"fromSimpleFill",value:function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.color,s=a&&"esriSFSNull"!==e.style&&(0,M.aH)(a)||0,o=n?k.Uh:0,u=e.materialKey;if(t){var l=t.rect,h=t.width,c=t.height,f=t.pixelRatio,v=l.x+k.fL,_=l.y+k.fL,d=v+h,y=_+c,p=(0,Z.UJ)(v,_),m=(0,Z.UJ)(d,y);i=new r(u,t,s,p,m,h/f,c/f,0,0,De,De,0,o,null,b.Xe,b.eW)}else i=new r(u,null,s,0,0,0,0,0,0,0,0,0,o,null,b.Xe,b.eW);return i._maybeAddLineTemplate(e),i}},{key:"fromPictureFill",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=k.ru,a=t.rect,s=t.width,o=t.height,u=a.x+k.fL,l=a.y+k.fL,h=u+s,c=l+o,f=(0,Z.UJ)(u,l),v=(0,Z.UJ)(h,c),_=Math.round((0,g.F2)(e.width)),d=Math.round((0,g.F2)(e.height)),y=(0,g.F2)(e.xoffset),p=(0,g.F2)(-e.yoffset),m=e.materialKey,x=i?k.Uh:0,M=new r(m,t,n,f,v,_,d,y,p,De*e.xscale,De*e.yscale,0,x,null,b.Xe,b.eW);return M._maybeAddLineTemplate(e),M}}]),r}(me(ye.Z)),Ve=r(64580),Ge=r(27344),Oe=function(){function e(){(0,s.Z)(this,e),this._resolver=null}return(0,o.Z)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._resolver){e.next=7;break}return e.next=3,this._resolver.promise;case 3:return e.next=5,this.acquire();case 5:e.next=8;break;case 7:this._resolver=(0,c.hh)();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this._resolver;this._resolver=null,null===e||void 0===e||e.resolve()}}]),e}();function Je(){return Je=(0,n.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.acquire();case 3:return e.next=5,r(n);case 5:t.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),Je.apply(this,arguments)}var Ke=r(98125),Xe=h.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Ne=new Array,He={isOutline:!1,placement:null,symbologyType:v.mD.DEFAULT,vvFlags:0},Ye=(0,u.Z)((0,u.Z)({},f.eG),{},{hash:JSON.stringify(f.eG),materialKey:(0,_.jj)(v.LW.MARKER,He)}),qe=(0,u.Z)((0,u.Z)({},f.wW),{},{hash:JSON.stringify(f.wW),materialKey:(0,_.jj)(v.LW.LINE,He)}),je=(0,u.Z)((0,u.Z)({},f.lj),{},{hash:JSON.stringify(f.lj),materialKey:(0,_.jj)(v.LW.FILL,He)});function Qe(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function $e(e){return!!(1&e)}var et=function(){function e(t,r){(0,s.Z)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Oe,this._fetchResource=t,this._tileInfo=r}return(0,o.Z)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var i=new Array;t&&this._createMeshTemplates(i,t,!0),this._createMeshTemplates(i,e,!1);var n=this._createGroupId("expanded-cim"===e.type&&tt(e));return this._idToTemplateGroup.set(n,i),this._symbolToTemplate.set(r,n),n}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):Ne}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?($e(e)||Xe.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):Ne}},{key:"getMosaicItem",value:function(e,t){var r=this,i=this._createTemplateId(),n=new Promise((function(e){return r._idToResolver.set(i,e)}));return this._fetchQueue.push({symbol:e,id:i,glyphIds:t}),n}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return Je.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],je,!1),marker:this._createMeshTemplates([],Ye,!1),line:this._createMeshTemplates([],qe,!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(i).then((function(){return t._fetchResource(r,e).then((function(e){var r,i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var n=r.value,s=n.id,o=n.mosaicItem;t._idToResolver.get(s)(o),t._idToResolver.delete(s)}}catch(u){i.e(u)}finally{i.f()}}))})).catch((function(e){(0,c.D_)(e)?t._fetchQueue=t._fetchQueue.concat(r):function(e){return"worker:port-closed"===e.name}(e)||Xe.error(new l.Z("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?Ve.Z.fromSimpleMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?Ve.Z.fromPictureMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,a=n.spriteMosaicItem,e.abrupt("return",(0,we.ok)(a,Xe)?Ue.fromSimpleFill(t,a,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,a=n.spriteMosaicItem,e.abrupt("return",(0,we.ok)(a,Xe)?Ue.fromPictureFill(t,a,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,a=n.spriteMosaicItem,e.abrupt("return",(0,we.ok)(a,Xe)?pe.fromSimpleLine(t,a):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?Ve.Z.fromLineSymbolMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",Ge.Z.fromText(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem((0,Ke.xS)(t),(0,Ee._)(t.text));case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",(0,we.ok)(n,Xe)?Ge.Z.fromCIMText(t,n,this._tileInfo):this._textError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem((0,Ke.xS)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?Ue.fromCIMFill(t,n,this._tileInfo):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem((0,Ke.xS)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?pe.fromCIMLine(t,n,this._tileInfo):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem((0,Ke.xS)(t));case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",(0,we.ok)(n,Xe)?Ve.Z.fromCIMMarker(t,n,this._tileInfo):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?10:"fill"===e.t0?14:"text"===e.t0?18:21;break;case 6:return e.next=8,this._createCIMMarker(t);case 8:return n=e.sent,e.abrupt("break",21);case 10:return e.next=12,this._createCIMLine(t);case 12:return n=e.sent,e.abrupt("break",21);case 14:return e.next=16,this._createCIMFill(t);case 16:return n=e.sent,e.abrupt("break",21);case 18:return e.next=20,this._createCIMText(t);case 20:n=e.sent;case 21:return e.abrupt("return",(this._cimTemplateCache.set(r,n),n));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:e.t0=t.type,e.next="marker"===e.t0?6:"line"===e.t0?8:"fill"===e.t0?10:"text"===e.t0?12:13;break;case 6:return n=Te.fromCIMMarker(t,this._tileInfo),e.abrupt("break",13);case 8:return n=be.fromCIMLine(t,this._tileInfo),e.abrupt("break",13);case 10:return n=Ze.fromCIMFill(t,this._tileInfo),e.abrupt("break",13);case 12:n=Be.fromCIMText(t,this._tileInfo);case 13:return e.abrupt("return",(this._cimTemplateCache.set(r,n),n));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return Qe(e,this._createSMS(t));case"esriPMS":return Qe(e,this._createPMS(t));case"esriSFS":return Qe(e,this._createSFS(t,r));case"line-marker":return Qe(e,this._createLMS(t));case"esriPFS":return Qe(e,this._createPFS(t,r));case"esriSLS":return Qe(e,this._createSLS(t,!1));case"esriTS":return Qe(e,this._createTS(t));default:return Xe.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(t.type.includes("3d"))return Xe.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var i,n=(0,a.Z)(t.layers);try{for(n.s();!(i=n.n()).done;){var s=i.value;"function"==typeof s.materialHash?Qe(e,this._createDynamicCIM(s)):Qe(e,this._createCIM(s))}}catch(h){n.e(h)}finally{n.f()}return e}if("composite-symbol"===t.type){var o,u=(0,a.Z)(t.layers);try{for(u.s();!(o=u.n()).done;){var l=o.value;this._createPrimitiveMeshTemplates(e,l,r)}}catch(h){u.e(h)}finally{u.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),tt=function(e){if(!e.layers)return!1;var t,r=(0,a.Z)(e.layers);try{for(r.s();!(t=r.n()).done;){if("function"==typeof t.value.materialHash)return!0}}catch(i){r.e(i)}finally{r.f()}return!1}},27344:function(e,t,r){r.d(t,{Z:function(){return x}});var i=r(29439),n=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(75746),l=r(17842),h=r(48202),c=r(38999),f=r(65800),v=r(94109),_=r(73271),d=r(54815),y=r(42093),p=r(5748),m=r(52993),x=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a,s,o,u,f,y,p,m,x,g,M,k,w,Z,b,L){var S,W=arguments.length>18&&void 0!==arguments[18]&&arguments[18],P=arguments.length>19?arguments[19]:void 0,I=arguments.length>20?arguments[20]:void 0;(0,n.Z)(this,r),(S=t.call(this))._xOffset=(0,l.F2)(M),S._yOffset=(0,l.F2)(k),S._decoration=m||"none",S._color=o,S._haloColor=u,S._haloSize=Math.min(Math.floor(5*(0,l.F2)((0,l.t_)(a))),127),S._size=Math.min(Math.round((0,l.F2)(i)),127);var T=Math.min(Math.round((0,l.F2)(s||i)),127);S._referenceSize=Math.round(Math.sqrt(256*T)),S._scale=S._size/v.Ex,S._angle=g,S._justify=(0,c.Hd)(f||"center"),S._xAlignD=(0,c.kH)(f||"center"),S._yAlignD=(0,c.b7)(y||"baseline"),S._baseline="baseline"===(y||"baseline"),S._bitset=(p===h.v2.MAP?1:0)|(x?1:0)<<1;var z=d.m2.load(e);return z.sdf=!0,S._materialKey=z.data,S._lineWidth=(0,l.F2)(w)||512,S._lineHeight=Z||1,S._textPlacement=b,S._effects=L,S._isCIM=W,S._minMaxZoom=(0,_.UJ)(Math.round(P*v.MI),Math.round(I*v.MI)),S}return(0,a.Z)(r,null,[{key:"fromText",value:function(e,t){var n=new r(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&(0,f.aH)(e.color)||0,e.haloColor&&(0,f.aH)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,h.v2.SCREEN,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,y.Xe,y.eW),a=(0,u.E)(e.text),s=(0,i.Z)(a,2)[1];return n.bindTextInfo(t,s),n._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,n}},{key:"fromCIMText",value:function(e,t,n){var a=e.scaleFactor||1,s=e.size*e.sizeRatio*a,o=(0,y._f)(e.scaleInfo,n),l=(0,i.Z)(o,2),h=l[0],c=l[1],v=new r(e.materialKey,s,e.outlineSize*e.sizeRatio,e.referenceSize,(0,f.t2)(e.color),(0,f.t2)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*a,e.offsetY*e.sizeRatio*a,512,1,e.markerPlacement,e.effects,!0,h,c),_=(0,u.E)(e.text),d=(0,i.Z)(_,2)[1];return v.bindTextInfo(t,d),v._vertexBoundsScale=e.maxVVSize?e.maxVVSize/s:1,v}}]),r}((0,p.Z)(m.Z))},42093:function(e,t,r){r.d(t,{Fv:function(){return o},NW:function(){return h},TK:function(){return u},Xe:function(){return i},_f:function(){return c},eW:function(){return n},lu:function(){return a},mf:function(){return l}});var i=0,n=100;function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function o(e){var t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function u(e,t){return s(e[0]-t[0],e[1]-t[1])}function l(e){return"function"==typeof e}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function c(e,t){return[!!e.minScale&&t.scaleToZoom(e.minScale)||i,!!e.maxScale&&t.scaleToZoom(e.maxScale)||n]}},69813:function(e,t,r){r.d(t,{fL:function(){return M}});var i=r(29439),n=r(1413),a=r(37762),s=r(11752),o=r(61120),u=r(60136),l=r(29388),h=r(74165),c=r(15671),f=r(43144),v=r(15861),_=r(10064),d=r(32718),y=r(16054),p=r(819),m=r(91935),x=r(98125),g=d.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function M(e,t,r,i){return k.apply(this,arguments)}function k(){return(k=(0,v.Z)((0,h.Z)().mark((function e(t,r,i,n){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0||"heatmap"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"pie-chart"===e.t0?7:"subtype"===e.t0?8:9;break;case 3:return e.abrupt("return",Z.fromBasicRenderer(t,r,i,n));case 4:return e.abrupt("return",S.fromUVRenderer(t,r,i,n));case 5:return e.abrupt("return",L.fromCBRenderer(t,r,i,n));case 6:return e.abrupt("return",z.fromDictionaryRenderer(t,r,i,n));case 7:return e.abrupt("return",b.fromPieChartRenderer(t,r,i,n));case 8:return e.abrupt("return",b.fromSubtypes(t,r,i,n));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w,Z=function(){function e(){(0,c.Z)(this,e),this.type="feature",this._defaultResult=null}return(0,f.Z)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,i,n){return this.getDefault()}},{key:"analyze",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,r,i,n,a,s){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=(0,v.Z)((0,h.Z)().mark((function t(r,i,n,a){var s,o,u;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,(0,x.B3)(r.symbol,n,a);case 4:o=t.sent,u=i.createTemplateGroup(o,null),s.setDefault(u);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,i,n){return t.apply(this,arguments)}}()},{key:"fromPieChartRenderer",value:function(){var t=(0,v.Z)((0,h.Z)().mark((function t(r,i,n,a){var s,o,u,l;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.markerSymbol){t.next=12;break}return t.next=4,(0,x.B3)(r.markerSymbol,n,a);case 4:if(o=t.sent,t.t0=r.fillSymbol,!t.t0){t.next=10;break}return t.next=9,(0,x.B3)(r.fillSymbol,n,a);case 9:u=t.sent;case 10:l=i.createTemplateGroup(o,u),s.setDefault(l);case 12:return t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)})));return function(e,r,i,n){return t.apply(this,arguments)}}()}]),e}(),b=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e,i){var n;return(0,c.Z)(this,r),(n=t.call(this))._subMatchers=e,n._subtypeField=i,n}return(0,f.Z)(r,[{key:"match",value:function(e,t,r,i,n){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,i,n):null}}],[{key:"fromSubtypes",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,i,n,a){var s,o,u,l;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(l in s=new Map,o=[],u=function(e){var r=parseInt(e,10),u=M(t.renderers[e],i,n,a).then((function(e){return s.set(r,e)}));o.push(u)},t.renderers)u(l);return e.next=5,Promise.all(o);case 5:return e.abrupt("return",new r(s,t.subtypeField));case 6:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(Z),L=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e,i,n,a){var s;return(0,c.Z)(this,r),(s=t.call(this)).type="interval",s._intervals=[],s._isMaxInclusive=i,s._fieldIndex=a,s._field=e,s._normalizationInfo=n,s}return(0,f.Z)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return(0,s.Z)((0,o.Z)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(null==a||isNaN(a)||a===1/0||a===-1/0)return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],u=o.interval,l=o.result,h=a>=u.min,c=this._isMaxInclusive?a<=u.max:a<u.max;if(h&&c)return l}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var r=this._normalizationInfo,i=r.normalizationField,n=r.normalizationTotal,a=r.normalizationType,s=!!i&&e.readAttribute(i);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/n*100;default:return void g.error("Found unknown normalization type: ".concat(a))}else g.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,i,n,a){var s,o,u,l,c,f,_,d,y;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.isMaxInclusive,o=t.normalizationField,u=t.normalizationTotal,l=t.normalizationType,c=t.field,f=new r(c,s,{normalizationField:o,normalizationTotal:u,normalizationType:l},t.fieldIndex),e.next=8,(0,x.B3)(t.backgroundFillSymbol,n,a);case 8:return _=e.sent,e.next=11,Promise.all(t.intervals.map(function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t){var r,s,o;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,x.B3)(t.symbol,n,a);case 2:return r=e.sent,e.next=5,i.createTemplateGroup(r,_);case 5:s=e.sent,o={min:t.min,max:t.max},f.add(o,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,(0,x.B3)(t.defaultSymbol,n,a);case 13:if(!(d=e.sent)){e.next=19;break}return e.next=17,i.createTemplateGroup(d,_);case 17:y=e.sent,f.setDefault(y);case 19:return e.abrupt("return",f);case 20:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(Z),S=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e,i,n){var a;return(0,c.Z)(this,r),(a=t.call(this)).type="map",a._nullResult=null,a._resultsMap=new Map,a._fieldsIndex=n,a._fields=e,a._seperator=i||"",a}return(0,f.Z)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return(0,s.Z)((0,o.Z)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],i=(0,a.Z)(this._fields);try{for(i.s();!(t=i.n()).done;){var n=t.value,s=e.readAttribute(n);null==s||""===s?r.push("<Null>"):r.push(s)}}catch(o){i.e(o)}finally{i.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,i,n,a){var s,o,u,l,c,f;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.fieldDelimiter,o=[t.field],t.field2&&o.push(t.field2),t.field3&&o.push(t.field3),e.next=4,(0,x.B3)(t.backgroundFillSymbol,n,a);case 4:return u=e.sent,l=new r(o,s,t.fieldIndex),e.next=8,Promise.all(t.map.map(function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t){var r,s;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,x.B3)(t.symbol,n,a);case 2:return r=e.sent,e.next=5,i.createTemplateGroup(r,u);case 5:s=e.sent,"<Null>"===t.value?l.setNullResult(s):l.add(t.value,s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,(0,x.B3)(t.defaultSymbol,n,a);case 10:if(!(c=e.sent)){e.next=16;break}return e.next=14,i.createTemplateGroup(c,u);case 14:f=e.sent,l.setDefault(f);case 16:return e.abrupt("return",l);case 17:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),r}(Z);function W(e,t){return P.apply(this,arguments)}function P(){return(P=(0,v.Z)((0,h.Z)().mark((function e(t,r){var i,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(i=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return i}));case 3:return e.next=5,(0,p.Yi)(i,r.spatialReference,r.fields);case 5:return n=e.sent,e.abrupt("return",(function(e,t,i){return(0,m.Z)(n,e,{$view:i},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return T.apply(this,arguments)}function T(){return(T=(0,v.Z)((0,h.Z)().mark((function e(){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(w||(w=r.e(5164).then(r.bind(r,85164))),w));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(e){(0,u.Z)(s,e);var t=(0,l.Z)(s);function s(e,r,i,n,a,o){var u;return(0,c.Z)(this,s),(u=t.call(this)).type="dictionary",u._groupIdCache=new y.Z(100),u._loader=e,u._fieldMap=e.fieldMap,u._symbolFields=e.getSymbolFields(),u._templates=r,u._info=i,u._scaleFn=n,u._schemaUtilsModule=a,u._symbolOptions=o,u}return(0,f.Z)(s,[{key:"_analyzeFeature",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,r,i,s,o){var u,l,c,f,v,d,y,p,m=this;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.readLegacyFeature(),l=this._scaleFn(u,i,s),c=this._attributeHash(u)+"-"+l,!(f=this._groupIdCache.get(c))){e.next=3;break}return e.abrupt("return",f);case 3:return v=(0,n.Z)((0,n.Z)({},s),{},{spatialReference:this._info.spatialReference,abortOptions:o,fields:this._info.fields}),e.next=6,this._loader.getSymbolAsync(u,v);case 6:return d=e.sent,y=this._schemaUtilsModule.createSymbolSchema(d,this._symbolOptions),p=(0,x.B3)(y,this._info,r,o).then((function(e){if("expanded-cim"!==e.type)return g.error(new _.Z("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+l;var t,r=(0,a.Z)(e.layers);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.scaleFactor=l,i.templateHash+="-"+l}}catch(n){r.e(n)}finally{r.f()}return m._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(c,p,1),p));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,r,i,n,a,s){var o,u;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.getCursor(),u=[];o.next();)u.push(this._analyzeFeature(o,i,n,a,s));return e.abrupt("return",Promise.all(u));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,s){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,i,n){return null}},{key:"_attributeHash",value:function(e){var t,r="",i=(0,a.Z)(this._symbolFields);try{for(i.s();!(t=i.n()).done;){var n=t.value,s=this._fieldMap[n];s&&(r+=e.attributes[s]+"-")}}catch(o){i.e(o)}finally{i.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=(0,v.Z)((0,h.Z)().mark((function e(t,n,a,o){var u,l,c,f,v,_;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.resolve().then(r.bind(r,75465)),I()]);case 2:return u=e.sent,l=(0,i.Z)(u,2),c=l[0].DictionaryLoader,f=l[1],v=new c(t.url,t.config,t.fieldMap),e.next=9,v.fetchResources({spatialReference:a.spatialReference,fields:a.fields});case 9:return e.next=11,W(t.scaleExpression,a);case 11:return _=e.sent,e.abrupt("return",new s(v,n,a,_,f,t.symbolOptions));case 13:case"end":return e.stop()}}),e)})));return function(t,r,i,n){return e.apply(this,arguments)}}()}]),s}(Z)},55940:function(e,t,r){r.d(t,{ok:function(){return n}});var i=r(10064);function n(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new i.Z(r.name,r.message,r.details)),!1}return!0}},27446:function(e,t,r){r.d(t,{Z:function(){return a}});var i=r(15671),n=r(43144),a=function(){function e(t,r){(0,i.Z)(this,e),this._pos=0;var n=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return(0,n.Z)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),i=new this._ctor(r);i.set(this._buffer,0),this._array=r,this._buffer=i,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var i=t;i!==r;i++)this.writeFixed(e._buffer[i])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}()},35092:function(e,t,r){r.d(t,{M:function(){return i}});r(67906);function i(e,t,r,i){var n=e.clone(),a=1<<n.level,s=n.col+t,o=n.row+r;return i&&s<0?(n.col=s+a,n.world-=1):s>=a?(n.col=s-a,n.world+=1):n.col=s,n.row=o,n}},27301:function(e,t,r){function i(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}r.d(t,{_:function(){return i}})}}]);
//# sourceMappingURL=9484.6f3221bf.chunk.js.map