"use strict";(self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD=self.webpackChunkData_Design_AI_for_Urban_Data_and_Viz_Harvard_GSD||[]).push([[5482],{35482:function(r,e,t){t.r(e),t.d(e,{default:function(){return D}});var a=t(37762),n=t(15671),o=t(43144),l=t(92026),i=t(18722),u=t(48976),f=t(4582),s=t(11186),c=t(8229),v=t(52587),b=t(78952),d=t(21134),p=t(89431),h=t(87005),y=t(28278),m=t(2821);function g(r,e,t,a){var n=r.rendererJSON,o=r.isRGBRenderer,l=null,i=null;if(e&&o)l=e;else if(e&&"pointCloudUniqueValueRenderer"===n.type){var u=(i=h.Z.fromJSON(n)).colorUniqueValueInfos;l=new Uint8Array(3*a);for(var f=_(i.fieldTransformType),s=0;s<a;s++)for(var c=(f?f(e[s]):e[s])+"",v=0;v<u.length;v++)if(u[v].values.includes(c)){l[3*s]=u[v].color.r,l[3*s+1]=u[v].color.g,l[3*s+2]=u[v].color.b;break}}else if(e&&"pointCloudStretchRenderer"===n.type){var b=(i=p.Z.fromJSON(n)).stops;l=new Uint8Array(3*a);for(var y=_(i.fieldTransformType),m=0;m<a;m++){var g=y?y(e[m]):e[m],I=b.length-1;if(g<b[0].value)l[3*m]=b[0].color.r,l[3*m+1]=b[0].color.g,l[3*m+2]=b[0].color.b;else if(g>=b[I].value)l[3*m]=b[I].color.r,l[3*m+1]=b[I].color.g,l[3*m+2]=b[I].color.b;else for(var A=1;A<b.length;A++)if(g<b[A].value){var C=(g-b[A-1].value)/(b[A].value-b[A-1].value);l[3*m]=b[A].color.r*C+b[A-1].color.r*(1-C),l[3*m+1]=b[A].color.g*C+b[A-1].color.g*(1-C),l[3*m+2]=b[A].color.b*C+b[A-1].color.b*(1-C);break}}}else if(e&&"pointCloudClassBreaksRenderer"===n.type){var S=(i=d.Z.fromJSON(n)).colorClassBreakInfos;l=new Uint8Array(3*a);for(var D=_(i.fieldTransformType),M=0;M<a;M++)for(var k=D?D(e[M]):e[M],w=0;w<S.length;w++)if(k>=S[w].minValue&&k<=S[w].maxValue){l[3*M]=S[w].color.r,l[3*M+1]=S[w].color.g,l[3*M+2]=S[w].color.b;break}}else{l=new Uint8Array(3*a);for(var Z=0;Z<l.length;Z++)l[Z]=255}if(t&&i&&i.colorModulation)for(var O=i.colorModulation.minValue,U=i.colorModulation.maxValue,x=0;x<a;x++){var z=t[x],F=z>=U?1:z<=O?.3:.3+.7*(z-O)/(U-O);l[3*x]=F*l[3*x],l[3*x+1]=F*l[3*x+1],l[3*x+2]=F*l[3*x+2]}return l}function I(r,e,t){return(0,l.pC)(r)&&r.attributeInfo.useElevation?function(r,e){for(var t=new Float64Array(e),a=0;a<e;a++)t[a]=r[3*a+2];return t}(e,t):(0,l.pC)(r)?(0,y.qM)(r.attributeInfo.storageInfo,r.buffer,t):null}function _(r){return null==r||"none"===r?null:"low-four-bit"===r?function(r){return 15&r}:"high-four-bit"===r?function(r){return(240&r)>>4}:"absolute-value"===r?function(r){return Math.abs(r)}:"modulo-ten"===r?function(r){return r%10}:null}function A(r){var e,t=0,n=(0,a.Z)(r||[]);try{for(n.s();!(e=n.n()).done;){t|=1<<e.value}}catch(o){n.e(o)}finally{n.f()}return t}var C=function(){function r(){(0,n.Z)(this,r)}return(0,o.Z)(r,[{key:"transform",value:function(r){var e=this._transform(r),t=[e.points.buffer,e.rgb.buffer];(0,l.pC)(e.pointIdFilterMap)&&t.push(e.pointIdFilterMap.buffer);var n,o=(0,a.Z)(e.attributes);try{for(o.s();!(n=o.n()).done;){var u=n.value;"buffer"in u.values&&(0,i.eP)(u.values.buffer)&&u.values.buffer!==e.rgb.buffer&&t.push(u.values.buffer)}}catch(f){o.e(f)}finally{o.f()}return Promise.resolve({result:e,transferList:t})}},{key:"_transform",value:function(r){var e=function(r,e){if(null==r.encoding||""===r.encoding){var t=(0,y.W7)(e,r);if((0,l.Wi)(t.vertexAttributes.position))return;for(var a=(0,y.I_)(e,t.vertexAttributes.position),n=t.header.fields,o=[n.offsetX,n.offsetY,n.offsetZ],i=[n.scaleX,n.scaleY,n.scaleZ],u=a.length/3,f=new Float64Array(3*u),s=0;s<u;s++)f[3*s]=a[3*s]*i[0]+o[0],f[3*s+1]=a[3*s+1]*i[1]+o[1],f[3*s+2]=a[3*s+2]*i[2]+o[2];return f}if("lepcc-xyz"===r.encoding)return(0,m.Gi)(e).result}(r.schema,r.geometryBuffer),t=e.length/3,n=null,o=[],i=I(r.primaryAttributeData,e,t);(0,l.pC)(r.primaryAttributeData)&&i&&o.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:i});var u=I(r.modulationAttributeData,e,t);(0,l.pC)(r.modulationAttributeData)&&u&&o.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:u});var f=g(r.rendererInfo,i,u,t);if(r.filterInfo&&r.filterInfo.length>0&&(0,l.pC)(r.filterAttributesData)){var s=r.filterAttributesData.map((function(r){var a=I(r,e,t),n={attributeInfo:r.attributeInfo,values:a};return o.push(n),n}));n=new Uint32Array(t),t=function(r,e,t,n,o){for(var l=r.length/3,i=0,u=0;u<l;u++){for(var f=!0,s=0;s<n.length&&f;s++){var c=n[s].filterJSON,v=o[s].values[u];switch(c.type){case"pointCloudValueFilter":var b="exclude"===c.mode;c.values.includes(v)===b&&(f=!1);break;case"pointCloudBitfieldFilter":var d=A(c.requiredSetBits),p=A(c.requiredClearBits);(v&d)===d&&0==(v&p)||(f=!1);break;case"pointCloudReturnFilter":var h,y=15&v,m=v>>>4&15,g=m>1,I=1===y,_=y===m,C=!1,S=(0,a.Z)(c.includedReturns);try{for(S.s();!(h=S.n()).done;){var D=h.value;if("last"===D&&_||"firstOfMany"===D&&I&&g||"lastOfMany"===D&&_&&g||"single"===D&&!g){C=!0;break}}}catch(M){S.e(M)}finally{S.f()}C||(f=!1)}}f&&(t[i]=u,r[3*i]=r[3*u],r[3*i+1]=r[3*u+1],r[3*i+2]=r[3*u+2],e[3*i]=e[3*u],e[3*i+1]=e[3*u+1],e[3*i+2]=e[3*u+2],i++)}return i}(e,f,n,r.filterInfo,s)}var c,v=(0,a.Z)(r.userAttributesData);try{for(v.s();!(c=v.n()).done;){var d=c.value,p=I(d,e,t);o.push({attributeInfo:d.attributeInfo,values:p})}}catch(_){v.e(_)}finally{v.f()}3*t<f.length&&(f=new Uint8Array(f.buffer.slice(0,3*t))),this._applyElevationOffsetInPlace(e,t,r.elevationOffset);var h=this._transformCoordinates(e,t,r.obb,b.Z.fromJSON(r.inSR),b.Z.fromJSON(r.outSR));return{obb:r.obb,points:h,rgb:f,attributes:o,pointIdFilterMap:n}}},{key:"_transformCoordinates",value:function(r,e,t,a,n){if(!(0,v.CM)(r,a,0,r,n,0,e))throw new Error("Can't reproject");var o=(0,c.f)(t.center[0],t.center[1],t.center[2]),l=(0,c.c)(),i=(0,c.c)();(0,u.c)(S,t.quaternion);for(var f=new Float32Array(3*e),b=0;b<e;b++)l[0]=r[3*b]-o[0],l[1]=r[3*b+1]-o[1],l[2]=r[3*b+2]-o[2],(0,s.q)(i,l,S),t.halfSize[0]=Math.max(t.halfSize[0],Math.abs(i[0])),t.halfSize[1]=Math.max(t.halfSize[1],Math.abs(i[1])),t.halfSize[2]=Math.max(t.halfSize[2],Math.abs(i[2])),f[3*b]=l[0],f[3*b+1]=l[1],f[3*b+2]=l[2];return f}},{key:"_applyElevationOffsetInPlace",value:function(r,e,t){if(0!==t)for(var a=0;a<e;a++)r[3*a+2]+=t}}]),r}(),S=(0,f.c)();function D(){return new C}}}]);
//# sourceMappingURL=5482.3da81922.chunk.js.map