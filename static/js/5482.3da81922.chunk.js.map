{"version":3,"file":"static/js/5482.3da81922.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js","../node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as o}from\"../../../../core/maybe.js\";import r from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import t from\"../../../../renderers/PointCloudStretchRenderer.js\";import l from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as n,createTypedView as s,readBinaryAttribute as i}from\"./I3SBinaryReader.js\";import{decodeXYZ as u}from\"./LEPCC.js\";function f(e,o,n,s){const{rendererJSON:i,isRGBRenderer:u}=e;let f=null,c=null;if(o&&u)f=o;else if(o&&\"pointCloudUniqueValueRenderer\"===i.type){c=l.fromJSON(i);const e=c.colorUniqueValueInfos;f=new Uint8Array(3*s);const r=p(c.fieldTransformType);for(let t=0;t<s;t++){const l=(r?r(o[t]):o[t])+\"\";for(let o=0;o<e.length;o++)if(e[o].values.includes(l)){f[3*t]=e[o].color.r,f[3*t+1]=e[o].color.g,f[3*t+2]=e[o].color.b;break}}}else if(o&&\"pointCloudStretchRenderer\"===i.type){c=t.fromJSON(i);const e=c.stops;f=new Uint8Array(3*s);const r=p(c.fieldTransformType);for(let t=0;t<s;t++){const l=r?r(o[t]):o[t],n=e.length-1;if(l<e[0].value)f[3*t]=e[0].color.r,f[3*t+1]=e[0].color.g,f[3*t+2]=e[0].color.b;else if(l>=e[n].value)f[3*t]=e[n].color.r,f[3*t+1]=e[n].color.g,f[3*t+2]=e[n].color.b;else for(let o=1;o<e.length;o++)if(l<e[o].value){const r=(l-e[o-1].value)/(e[o].value-e[o-1].value);f[3*t]=e[o].color.r*r+e[o-1].color.r*(1-r),f[3*t+1]=e[o].color.g*r+e[o-1].color.g*(1-r),f[3*t+2]=e[o].color.b*r+e[o-1].color.b*(1-r);break}}}else if(o&&\"pointCloudClassBreaksRenderer\"===i.type){c=r.fromJSON(i);const e=c.colorClassBreakInfos;f=new Uint8Array(3*s);const t=p(c.fieldTransformType);for(let r=0;r<s;r++){const l=t?t(o[r]):o[r];for(let o=0;o<e.length;o++)if(l>=e[o].minValue&&l<=e[o].maxValue){f[3*r]=e[o].color.r,f[3*r+1]=e[o].color.g,f[3*r+2]=e[o].color.b;break}}}else{f=new Uint8Array(3*s);for(let e=0;e<f.length;e++)f[e]=255}if(n&&c&&c.colorModulation){const e=c.colorModulation.minValue,o=c.colorModulation.maxValue,r=.3;for(let t=0;t<s;t++){const l=n[t],s=l>=o?1:l<=e?r:r+(1-r)*(l-e)/(o-e);f[3*t]=s*f[3*t],f[3*t+1]=s*f[3*t+1],f[3*t+2]=s*f[3*t+2]}}return f}function c(o,r){if(null==o.encoding||\"\"===o.encoding){const t=n(r,o);if(e(t.vertexAttributes.position))return;const l=s(r,t.vertexAttributes.position),i=t.header.fields,u=[i.offsetX,i.offsetY,i.offsetZ],f=[i.scaleX,i.scaleY,i.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*f[0]+u[0],a[3*e+1]=l[3*e+1]*f[1]+u[1],a[3*e+2]=l[3*e+2]*f[2]+u[2];return a}if(\"lepcc-xyz\"===o.encoding)return u(r).result}function a(e,r,t){return o(e)&&e.attributeInfo.useElevation?d(r,t):o(e)?i(e.attributeInfo.storageInfo,e.buffer,t):null}function d(e,o){const r=new Float64Array(o);for(let t=0;t<o;t++)r[t]=e[3*t+2];return r}function m(e,o,r,t,l){const n=e.length/3;let s=0;for(let i=0;i<n;i++){let n=!0;for(let e=0;e<t.length&&n;e++){const{filterJSON:o}=t[e],r=l[e].values[i];switch(o.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===o.mode;o.values.includes(r)===e&&(n=!1);break}case\"pointCloudBitfieldFilter\":{const e=b(o.requiredSetBits),t=b(o.requiredClearBits);(r&e)===e&&0==(r&t)||(n=!1);break}case\"pointCloudReturnFilter\":{const e=15&r,t=r>>>4&15,l=t>1,s=1===e,i=e===t;let u=!1;for(const r of o.includedReturns)if(\"last\"===r&&i||\"firstOfMany\"===r&&s&&l||\"lastOfMany\"===r&&i&&l||\"single\"===r&&!l){u=!0;break}u||(n=!1);break}}}n&&(r[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],o[3*s]=o[3*i],o[3*s+1]=o[3*i+1],o[3*s+2]=o[3*i+2],s++)}return s}function p(e){return null==e||\"none\"===e?null:\"low-four-bit\"===e?e=>15&e:\"high-four-bit\"===e?e=>(240&e)>>4:\"absolute-value\"===e?e=>Math.abs(e):\"modulo-ten\"===e?e=>e%10:null}function b(e){let o=0;for(const r of e||[])o|=1<<r;return o}export{d as elevationFromPositions,f as evaluateRenderer,m as filterInPlace,a as getAttributeValues,c as readGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.25/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as n}from\"../../../chunks/vec3f32.js\";import{projectBuffer as s}from\"../../../geometry/projection.js\";import i from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],n=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&n&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:n});const s=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&s&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:s});let c=b(r.rendererInfo,n,s,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const t=r.filterAttributesData.map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,t)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,i.fromJSON(r.inSR),i.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,i,u){if(!s(t,i,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=n(),m=n();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],"names":["f","e","o","n","s","i","rendererJSON","u","isRGBRenderer","c","type","l","colorUniqueValueInfos","Uint8Array","r","p","fieldTransformType","t","length","values","includes","color","g","b","stops","value","colorClassBreakInfos","minValue","maxValue","colorModulation","a","attributeInfo","useElevation","Float64Array","d","storageInfo","buffer","Math","abs","this","_transform","points","rgb","pointIdFilterMap","push","attributes","Promise","resolve","result","transferList","encoding","vertexAttributes","position","header","fields","offsetX","offsetY","offsetZ","scaleX","scaleY","scaleZ","schema","geometryBuffer","primaryAttributeData","modulationAttributeData","rendererInfo","filterInfo","filterAttributesData","map","Uint32Array","filterJSON","mode","requiredSetBits","requiredClearBits","includedReturns","m","userAttributesData","slice","_applyElevationOffsetInPlace","elevationOffset","_transformCoordinates","obb","inSR","outSR","Error","center","quaternion","Float32Array","halfSize","max","h"],"sourceRoot":""}